<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Table Selection Tool - DivePlan</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: linear-gradient(135deg, #f0f4f8, #fff, #f0f4f8); color: #333; }
        .container { max-width: 1000px; margin: 0 auto; padding: 20px; }
        
        header { background: linear-gradient(135deg, #062737 0%, #0d4a66 100%); color: white; padding: 30px; border-radius: 8px; margin-bottom: 30px; }
        header h1 { font-size: 32px; margin-bottom: 5px; }
        header p { font-size: 14px; opacity: 0.95; }
        
        .wizard { background: white; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
        .step-indicator { display: flex; justify-content: space-between; padding: 20px; background: #f9fafb; border-bottom: 2px solid #e5e7eb; border-radius: 8px 8px 0 0; }
        .step-indicator .step { flex: 1; text-align: center; padding: 10px; position: relative; }
        .step-indicator .step.active { color: #0d4a66; font-weight: 700; }
        .step-indicator .step.completed { color: #10b981; }
        .step-indicator .step:before { content: attr(data-step); display: block; width: 32px; height: 32px; margin: 0 auto 8px; border-radius: 50%; background: #e5e7eb; color: #6b7280; font-weight: bold; display: flex; align-items: center; justify-content: center; }
        .step-indicator .step.active:before { background: #0d4a66; color: white; }
        .step-indicator .step.completed:before { background: #10b981; color: white; content: "‚úì"; }
        
        .step-content { padding: 30px; }
        .step-panel { display: none; }
        .step-panel.active { display: block; animation: fadeIn 0.3s; }
        
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        
        h2 { color: #0d4a66; margin-bottom: 20px; font-size: 22px; }
        .description { color: #6b7280; margin-bottom: 20px; font-size: 14px; }
        
        .option-group { margin-bottom: 20px; }
        .option-label { display: block; margin-bottom: 12px; font-weight: 600; color: #374151; }
        
        .option-card { 
            padding: 16px; 
            border: 2px solid #e5e7eb; 
            border-radius: 6px; 
            cursor: pointer; 
            margin-bottom: 10px; 
            transition: all 0.2s;
            background: white;
        }
        .option-card:hover { border-color: #0d4a66; background: #f0f9ff; }
        .option-card.selected { border-color: #0d4a66; background: #f0f9ff; box-shadow: 0 0 0 3px rgba(13, 74, 102, 0.1); }
        
        .option-card h4 { color: #1f2937; margin-bottom: 4px; }
        .option-card p { color: #6b7280; font-size: 13px; }
        
        .button-group { display: flex; gap: 10px; margin-top: 30px; }
        button { padding: 12px 24px; border: none; border-radius: 6px; font-weight: 600; cursor: pointer; transition: all 0.2s; }
        .btn-primary { background: #0d4a66; color: white; }
        .btn-primary:hover { background: #062737; }
        .btn-primary:disabled { background: #cbd5e1; cursor: not-allowed; }
        .btn-secondary { background: white; color: #0d4a66; border: 2px solid #0d4a66; }
        .btn-secondary:hover { background: #f0f9ff; }
        
        .input-group { margin-bottom: 20px; }
        label { display: block; margin-bottom: 6px; font-weight: 600; color: #374151; }
        input, select { width: 100%; padding: 10px; border: 2px solid #e5e7eb; border-radius: 6px; font-size: 14px; }
        input:focus, select:focus { outline: none; border-color: #0d4a66; }
        
        .result-box { background: #f0f9ff; border: 2px solid #0284c7; border-radius: 8px; padding: 20px; margin-top: 20px; }
        .result-title { font-size: 16px; font-weight: 700; color: #0d4a66; margin-bottom: 10px; }
        .result-content { font-size: 14px; color: #1e40af; }
        .result-content div { margin-bottom: 8px; }
        
        .warning-box { background: #fffbeb; border-left: 4px solid #f59e0b; padding: 15px; border-radius: 6px; margin-bottom: 20px; }
        .warning-box strong { color: #d97706; }
        
        .summary-table { width: 100%; border-collapse: collapse; margin: 15px 0; }
        .summary-table td { padding: 10px; border-bottom: 1px solid #e5e7eb; }
        .summary-table td:first-child { font-weight: 600; color: #374151; width: 40%; }
        .summary-table td:last-child { color: #0d4a66; font-weight: 600; }
        
        footer { text-align: center; padding: 20px; color: #9ca3af; font-size: 12px; margin-top: 30px; border-top: 1px solid #e5e7eb; }
        
        @media (max-width: 768px) {
            .step-indicator { flex-wrap: wrap; }
            .step-indicator .step { font-size: 12px; }
            .step-content { padding: 20px; }
            h2 { font-size: 18px; }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üéØ Table Selection Tool</h1>
            <p>Step-by-step guide to select the correct decompression table for your dive</p>
        </header>

        <div class="wizard">
            <div class="step-indicator">
                <div class="step active" data-step="1" onclick="goToStep(1)">
                    Dive<br>Technique
                </div>
                <div class="step" data-step="2" onclick="goToStep(2)">
                    Gas<br>Type
                </div>
                <div class="step" data-step="3" onclick="goToStep(3)">
                    Depth<br>Range
                </div>
                <div class="step" data-step="4" onclick="goToStep(4)">
                    Exact<br>Values
                </div>
                <div class="step" data-step="5" onclick="goToStep(5)">
                    Result
                </div>
            </div>

            <!-- STEP 1: Dive Technique -->
            <div id="step1" class="step-panel active">
                <div class="step-content">
                    <h2>Step 1: Select Your Dive Technique</h2>
                    <p class="description">Choose the diving technique that best describes your planned dive operation.</p>

                    <div class="option-card" onclick="selectTechnique('no-stop')">
                        <h4>üü® No-Stop Diving</h4>
                        <p>Direct ascent to surface without decompression stops. Must stay within no-stop bottom time limits.</p>
                    </div>

                    <div class="option-card" onclick="selectTechnique('in-water')">
                        <h4>üü¶ In-Water Decompression</h4>
                        <p>Dives requiring mandatory decompression stops at specific depths during ascent using air.</p>
                    </div>

                    <div class="option-card" onclick="selectTechnique('surface-oxygen')">
                        <h4>üüß Surface/Oxygen Decompression</h4>
                        <p>In-water stops on air, then continued decompression at surface using oxygen. Bell-based or chamber-based.</p>
                    </div>

                    <div class="option-card" onclick="selectTechnique('nitrox')">
                        <h4>üü© Nitrox Diving</h4>
                        <p>Reduced nitrogen dives using nitrox gas (40% or 35% oxygen blends). Extended bottom times with reduced decompression.</p>
                    </div>

                    <div class="option-card" onclick="selectTechnique('bell-oxygen')">
                        <h4>üü™ Wet/Dry Bell with Oxygen</h4>
                        <p>Commercial diving using bell life support with in-bell oxygen decompression. Extended operational capability.</p>
                    </div>

                    <div class="button-group" style="margin-top: 40px;">
                        <button class="btn-primary" onclick="nextStep()" style="margin-left: auto;">Next Step ‚Üí</button>
                    </div>
                </div>
            </div>

            <!-- STEP 2: Gas Type -->
            <div id="step2" class="step-panel">
                <div class="step-content">
                    <h2>Step 2: Select Your Gas Type</h2>
                    <p class="description">Choose the breathing gas for your dive operation.</p>

                    <div class="warning-box" id="gasWarning"></div>

                    <div id="gasOptions"></div>

                    <div class="button-group" style="margin-top: 40px;">
                        <button class="btn-secondary" onclick="prevStep()">‚Üê Previous</button>
                        <button class="btn-primary" onclick="nextStep()" style="margin-left: auto;">Next Step ‚Üí</button>
                    </div>
                </div>
            </div>

            <!-- STEP 3: Depth Range -->
            <div id="step3" class="step-panel">
                <div class="step-content">
                    <h2>Step 3: Select Depth Range</h2>
                    <p class="description">Choose your dive depth range. This helps ensure the table can accommodate your planned bottom time.</p>

                    <div id="depthOptions"></div>

                    <div class="button-group" style="margin-top: 40px;">
                        <button class="btn-secondary" onclick="prevStep()">‚Üê Previous</button>
                        <button class="btn-primary" onclick="nextStep()" style="margin-left: auto;">Next Step ‚Üí</button>
                    </div>
                </div>
            </div>

            <!-- STEP 4: Exact Values -->
            <div id="step4" class="step-panel">
                <div class="step-content">
                    <h2>Step 4: Enter Exact Dive Values</h2>
                    <p class="description">Provide specific details for your dive plan. These values will be matched to available decompression table schedules.</p>

                    <div id="surfaceIntervalNote" class="warning-box" style="display: none;">
                        <strong>Surface Interval:</strong> Your surface interval affects which table variant to use (Base/H2/H4 indicate repetitive dive intervals: 12 hours / 2 hours / 4 hours).
                    </div>

                    <div class="input-group">
                        <label for="diveDepth">Actual Dive Depth (meters)</label>
                        <input type="number" id="diveDepth" min="0" max="100" step="1" onchange="calculateEAD()">
                    </div>

                    <div class="input-group">
                        <label for="bottomTime">Planned Bottom Time (minutes)</label>
                        <input type="number" id="bottomTime" min="0" max="500" step="1">
                    </div>

                    <div id="eadGroup" class="input-group" style="display: none;">
                        <label for="o2Percent">O‚ÇÇ Percentage</label>
                        <input type="number" id="o2Percent" min="21" max="100" step="1" value="40" onchange="calculateEAD()">
                        <div id="eadResult" style="margin-top: 8px; padding: 10px; background: #f0f9ff; border-radius: 6px; color: #0d4a66; font-size: 13px; display: none;">
                            EAD: <strong id="eadValue"></strong> meters
                        </div>
                    </div>

                    <div id="surfaceIntervalGroup" class="input-group" style="display: none;">
                        <label for="surfaceInterval">Surface Interval (hours)</label>
                        <select id="surfaceInterval">
                            <option value="12">12+ hours (Base table)</option>
                            <option value="4">4 hours (H4 table)</option>
                            <option value="2">2 hours (H2 table)</option>
                        </select>
                    </div>

                    <div class="button-group" style="margin-top: 40px;">
                        <button class="btn-secondary" onclick="prevStep()">‚Üê Previous</button>
                        <button class="btn-primary" onclick="nextStep()" style="margin-left: auto;">See Results ‚Üí</button>
                    </div>
                </div>
            </div>

            <!-- STEP 5: Results -->
            <div id="step5" class="step-panel">
                <div class="step-content">
                    <h2>Recommended Decompression Table</h2>
                    <p class="description">Based on your dive parameters, here is the recommended table for your operation.</p>

                    <div id="resultContent"></div>

                    <div class="button-group" style="margin-top: 40px;">
                        <button class="btn-secondary" onclick="resetWizard()">‚Üê Start Over</button>
                        <button class="btn-secondary" onclick="savePlan()">üíæ Save Plan</button>
                    </div>
                </div>
            </div>
        </div>

        <footer>
            DivePlan Table Selection Tool | Always consult with your diving supervisor before executing any dive plan
        </footer>
    </div>

    <script>
        const state = {
            technique: null,
            gas: null,
            depthRange: null,
            depth: 0,
            bottomTime: 0,
            o2: 40,
            surfaceInterval: '12',
            currentStep: 1
        };

        const tableMapping = {
            'no-stop-air': { code: 'ND15', name: 'No-Stop Air Table', depths: [12,15,18,21,24,27,30,33,36,39,42,45,48,51] },
            'in-water-air': { code: 'SIL15', name: 'Standard Air Table', depths: [12,15,18,21,24,27,30,33,36,39,42,45,48,51], hasVariants: true },
            'surface-oxygen-sox': { code: 'SOX15', name: 'Surface Oxygen Table', depths: [12,15,18,21,24,27,30,33,36,39,42,45,48,51], hasVariants: true },
            'surface-oxygen-sab': { code: 'SAB15', name: 'Backup Air Table (Oxygen Failure)', depths: [12,15,18,21,24,27,30,33,36,39,42,45,48,51], hasVariants: true },
            'nitrox-nia': { code: 'NIA15', name: 'Nitrox 40% Table', depths: [18,21,24,27], hasVariants: true },
            'nitrox-nib': { code: 'NIB15', name: 'Nitrox 35% Table', depths: [18,21,24,27,30,33], hasVariants: true },
            'bell-oxygen-box': { code: 'BOX15', name: 'Wet/Dry Bell Oxygen Table', depths: [12,15,18,21,24,27,30,33,36,39,42,45,48,51], hasVariants: false }
        };

        function selectTechnique(technique) {
            document.querySelectorAll('#step1 .option-card').forEach(c => c.classList.remove('selected'));
            event.target.closest('.option-card').classList.add('selected');
            state.technique = technique;
        }

        function selectGas(gas) {
            document.querySelectorAll('#step2 .option-card').forEach(c => c.classList.remove('selected'));
            event.target.closest('.option-card').classList.add('selected');
            state.gas = gas;
        }

        function selectDepthRange(range) {
            document.querySelectorAll('#step3 .option-card').forEach(c => c.classList.remove('selected'));
            event.target.closest('.option-card').classList.add('selected');
            state.depthRange = range;
        }

        function calculateEAD() {
            const depth = parseFloat(document.getElementById('diveDepth').value) || 0;
            const o2 = parseFloat(document.getElementById('o2Percent').value) || 40;
            
            if (state.technique === 'nitrox' && depth > 0) {
                const ead = (depth + 10) * ((100 - o2) / 79) - 10;
                document.getElementById('eadValue').textContent = ead.toFixed(1) + 'm (at ' + o2 + '% O‚ÇÇ)';
                document.getElementById('eadResult').style.display = 'block';
                state.o2 = o2;
            }
        }

        function updateStep() {
            // Hide all steps
            document.querySelectorAll('.step-panel').forEach(p => p.classList.remove('active'));
            document.querySelectorAll('.step-indicator .step').forEach(s => s.classList.remove('active', 'completed'));
            
            // Show current step
            document.getElementById('step' + state.currentStep).classList.add('active');
            document.querySelector(`.step-indicator .step[data-step="${state.currentStep}"]`).classList.add('active');
            
            // Mark previous steps as completed
            for (let i = 1; i < state.currentStep; i++) {
                document.querySelector(`.step-indicator .step[data-step="${i}"]`).classList.add('completed');
            }

            // Update step-specific content
            if (state.currentStep === 2) updateGasStep();
            if (state.currentStep === 3) updateDepthStep();
            if (state.currentStep === 4) updateValuesStep();
            if (state.currentStep === 5) generateResults();
        }

        function updateGasStep() {
            const gasOptions = {
                'no-stop': [
                    { gas: 'air', name: 'Air', desc: 'Standard compressed air breathing gas' }
                ],
                'in-water': [
                    { gas: 'air', name: 'Air', desc: 'Standard compressed air breathing gas for all depths' }
                ],
                'surface-oxygen': [
                    { gas: 'sox', name: 'With Oxygen', desc: 'Surface decompression with oxygen (SOX15 primary)' },
                    { gas: 'sab', name: 'Air Only (Backup)', desc: 'Backup air-only table if oxygen fails (SAB15)' }
                ],
                'nitrox': [
                    { gas: 'nia', name: 'NIA (40% O‚ÇÇ)', desc: 'Nitrox 40% blend - shallower depths (18-27m)' },
                    { gas: 'nib', name: 'NIB (35% O‚ÇÇ)', desc: 'Nitrox 35% blend - deeper capability (18-33m)' }
                ],
                'bell-oxygen': [
                    { gas: 'box', name: 'Bell Oxygen', desc: 'Wet/dry bell with oxygen decompression (BOX15)' }
                ]
            };

            const options = gasOptions[state.technique] || [];
            let html = '';
            options.forEach(opt => {
                html += `<div class="option-card" onclick="selectGas('${opt.gas}')">
                    <h4>${opt.name}</h4>
                    <p>${opt.desc}</p>
                </div>`;
            });
            document.getElementById('gasOptions').innerHTML = html;
            document.getElementById('gasWarning').innerHTML = state.technique === 'surface-oxygen' 
                ? '<strong>‚ö†Ô∏è Primary:</strong> Always plan with oxygen (SOX15). Use SAB15 only as emergency backup if oxygen fails.' 
                : '';
        }

        function updateDepthStep() {
            const depthRanges = {
                'no-stop-air': [
                    { range: 'shallow', min: 12, max: 18, desc: '12-18m (Shallow no-stop dives)' },
                    { range: 'medium', min: 18, max: 30, desc: '18-30m (Moderate depth)' },
                    { range: 'deep', min: 30, max: 51, desc: '30-51m (Deep operations)' }
                ],
                'in-water-air': [
                    { range: 'shallow', min: 12, max: 18, desc: '12-18m (Shallow dives)' },
                    { range: 'medium', min: 18, max: 30, desc: '18-30m (Standard commercial)' },
                    { range: 'deep', min: 30, max: 51, desc: '30-51m (Deep commercial)' }
                ],
                'surface-oxygen-sox': [
                    { range: 'shallow', min: 12, max: 18, desc: '12-18m (Shallow)' },
                    { range: 'medium', min: 18, max: 30, desc: '18-30m (Standard)' },
                    { range: 'deep', min: 30, max: 51, desc: '30-51m (Deep)' }
                ],
                'surface-oxygen-sab': [
                    { range: 'shallow', min: 12, max: 18, desc: '12-18m (Shallow)' },
                    { range: 'medium', min: 18, max: 30, desc: '18-30m (Standard)' },
                    { range: 'deep', min: 30, max: 51, desc: '30-51m (Deep)' }
                ],
                'nitrox-nia': [
                    { range: 'medium', min: 18, max: 27, desc: '18-27m (NIA 40% max depth)' }
                ],
                'nitrox-nib': [
                    { range: 'medium', min: 18, max: 30, desc: '18-30m (Standard)' },
                    { range: 'deep', min: 30, max: 33, desc: '30-33m (NIB 35% max)' }
                ],
                'bell-oxygen-box': [
                    { range: 'shallow', min: 12, max: 18, desc: '12-18m (Shallow)' },
                    { range: 'medium', min: 18, max: 30, desc: '18-30m (Standard)' },
                    { range: 'deep', min: 30, max: 51, desc: '30-51m (Deep)' }
                ]
            };

            const key = state.technique + '-' + state.gas;
            const ranges = depthRanges[key] || [];
            let html = '';
            ranges.forEach(r => {
                html += `<div class="option-card" onclick="selectDepthRange('${r.range}')">
                    <h4>${r.desc}</h4>
                    <p>Typical commercial dive range</p>
                </div>`;
            });
            document.getElementById('depthOptions').innerHTML = html;
        }

        function updateValuesStep() {
            document.getElementById('surfaceIntervalNote').style.display = state.technique === 'in-water-air' ? 'block' : 'none';
            document.getElementById('eadGroup').style.display = state.technique === 'nitrox' ? 'block' : 'none';
            document.getElementById('surfaceIntervalGroup').style.display = ['in-water-air', 'surface-oxygen-sox', 'surface-oxygen-sab', 'nitrox-nia', 'nitrox-nib'].includes(state.technique + '-' + state.gas) ? 'block' : 'none';
        }

        function generateResults() {
            const key = state.technique + '-' + state.gas;
            const table = tableMapping[key];
            
            let html = `<div class="result-box">
                <div class="result-title">‚úì Recommended Table</div>
                <table class="summary-table">
                    <tr><td>Table Code:</td><td>${table.code}</td></tr>
                    <tr><td>Table Name:</td><td>${table.name}</td></tr>
                    <tr><td>Your Depth:</td><td>${document.getElementById('diveDepth').value}m</td></tr>
                    <tr><td>Planned Bottom Time:</td><td>${document.getElementById('bottomTime').value} minutes</td></tr>`;
            
            if (state.technique === 'nitrox') {
                html += `<tr><td>O‚ÇÇ Mix:</td><td>${document.getElementById('o2Percent').value}%</td></tr>`;
                html += `<tr><td>EAD:</td><td>${document.getElementById('eadValue').textContent}</td></tr>`;
            }

            if (table.hasVariants) {
                const interval = document.getElementById('surfaceInterval').value;
                let variant = '';
                if (interval === '2') variant = 'H2' + table.code;
                else if (interval === '4') variant = 'H4' + table.code;
                else variant = table.code;
                html += `<tr><td>Specific Variant:</td><td>${variant}</td></tr>`;
                html += `<tr><td>Surface Interval:</td><td>${interval} hours</td></tr>`;
            }

            html += `</table></div>`;
            
            // Depth availability check
            const depth = parseInt(document.getElementById('diveDepth').value);
            const availableDepth = table.depths.includes(depth) ? depth : table.depths.find(d => d >= depth);
            
            if (availableDepth) {
                html += `<div style="margin-top: 15px; padding: 15px; background: #f0fdf4; border: 2px solid #10b981; border-radius: 6px;">
                    <strong style="color: #15803d;">‚úì Depth Available</strong><br>
                    Your selected depth (${depth}m) is available in the ${table.code} table. You can proceed with this table for your dive plan.
                </div>`;
            } else if (availableDepth > depth) {
                html += `<div style="margin-top: 15px; padding: 15px; background: #fffbeb; border: 2px solid #f59e0b; border-radius: 6px;">
                    <strong style="color: #d97706;">‚ö†Ô∏è Depth Adjustment Required</strong><br>
                    Your selected depth (${depth}m) is not available. Use depth ${availableDepth}m instead. This provides more conservative decompression for your safety.
                </div>`;
            } else {
                html += `<div style="margin-top: 15px; padding: 15px; background: #fee2e2; border: 2px solid #dc2626; border-radius: 6px;">
                    <strong style="color: #991b1b;">‚úó Depth Not Available</strong><br>
                    Your selected depth (${depth}m) exceeds the maximum available depth (${table.depths[table.depths.length-1]}m) in this table. Please select a shallower depth or different table.
                </div>`;
            }

            document.getElementById('resultContent').innerHTML = html;
        }

        function nextStep() {
            if (!isStepValid()) return;
            if (state.currentStep < 5) {
                state.currentStep++;
                updateStep();
                window.scrollTo(0, 0);
            }
        }

        function prevStep() {
            if (state.currentStep > 1) {
                state.currentStep--;
                updateStep();
                window.scrollTo(0, 0);
            }
        }

        function goToStep(step) {
            if (step > state.currentStep) return;
            state.currentStep = step;
            updateStep();
            window.scrollTo(0, 0);
        }

        function isStepValid() {
            switch (state.currentStep) {
                case 1: return state.technique !== null;
                case 2: return state.gas !== null;
                case 3: return state.depthRange !== null;
                case 4: return document.getElementById('diveDepth').value && document.getElementById('bottomTime').value;
                default: return true;
            }
        }

        function resetWizard() {
            state.technique = null;
            state.gas = null;
            state.depthRange = null;
            state.depth = 0;
            state.bottomTime = 0;
            state.currentStep = 1;
            updateStep();
            window.scrollTo(0, 0);
        }

        function savePlan() {
            const plan = JSON.stringify(state);
            const blob = new Blob([plan], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'dive-plan.json';
            a.click();
        }

        // Initialize
        updateStep();
    </script>
</body>
</html>
