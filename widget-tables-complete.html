<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DivePlan - Decompression Tables</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: linear-gradient(135deg, #f0f4f8, #ffffff, #f0f4f8); color: #333; min-height: 100vh; }
        .container { max-width: 1280px; margin: 0 auto; padding: 20px; }
        header { margin-bottom: 30px; }
        h1 { font-size: 32px; font-weight: 700; color: #1f2937; margin-bottom: 8px; }
        .subtitle { color: #6b7280; font-size: 16px; }
        
        .back-btn { background: #3b82f6; color: white; border: none; padding: 10px 16px; border-radius: 6px; cursor: pointer; font-size: 14px; font-weight: 500; margin-bottom: 20px; transition: all 0.2s; }
        .back-btn:hover { background: #2563eb; }
        
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 16px; margin-bottom: 20px; }
        
        .card {
            background: white;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            padding: 18px;
            cursor: pointer;
            transition: all 0.2s;
            text-align: left;
        }
        .card:hover { border-color: #3b82f6; box-shadow: 0 8px 16px rgba(0,0,0,0.1); }
        
        .tag {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 700;
            margin-bottom: 10px;
        }
        .tag-blue { background: #dbeafe; color: #1e40af; }
        .tag-cyan { background: #cffafe; color: #0e7490; }
        .tag-orange { background: #fed7aa; color: #92400e; }
        .tag-yellow { background: #fef08a; color: #854d0e; }
        .tag-purple { background: #e9d5ff; color: #5b21b6; }
        .tag-green { background: #dcfce7; color: #166534; }
        .tag-indigo { background: #e0e7ff; color: #312e81; }
        .tag-red { background: #fee2e2; color: #991b1b; }
        
        .card h3 { font-size: 16px; font-weight: 600; color: #1f2937; margin-bottom: 8px; }
        .card p { font-size: 13px; color: #6b7280; }
        .card .code { font-family: monospace; font-size: 12px; font-weight: bold; color: #3b82f6; margin-top: 8px; }
        .card .depths { font-size: 12px; color: #6b7280; margin-top: 6px; }
        
        .section { background: white; border-radius: 8px; padding: 18px; margin-bottom: 16px; border: 1px solid #e5e7eb; }
        .section h2 { font-size: 18px; font-weight: 600; color: #1f2937; margin-bottom: 4px; }
        .section p { font-size: 13px; color: #6b7280; }
        
        .depths-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(80px, 1fr)); gap: 10px; margin-top: 16px; }
        .depth-btn {
            padding: 12px;
            border: 2px solid #3b82f6;
            background: white;
            color: #3b82f6;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
            font-size: 14px;
            transition: all 0.2s;
        }
        .depth-btn:hover { background: #eff6ff; }
        .depth-btn.active { background: #3b82f6; color: white; }
        
        .table-wrapper { background: white; border-radius: 8px; overflow: hidden; box-shadow: 0 1px 3px rgba(0,0,0,0.1); }
        .table-header { background: linear-gradient(to bottom, #1d4ed8, #1e40af); color: white; padding: 16px; }
        .table-header h2 { font-size: 18px; font-weight: 600; margin-bottom: 2px; }
        .table-header p { font-size: 13px; opacity: 0.95; }
        
        .table-scroll { overflow-x: auto; }
        table { width: 100%; border-collapse: collapse; font-size: 12px; }
        thead { background: linear-gradient(to bottom, #1d4ed8, #1e40af); color: white; position: sticky; top: 0; z-index: 10; }
        th { padding: 10px 6px; text-align: center; border: 1px solid #0d47a1; font-weight: 600; font-size: 11px; line-height: 1.2; }
        td { padding: 10px 6px; text-align: center; border: 1px solid #e5e7eb; font-size: 11px; }
        
        .row-white { background: white; }
        .row-white:hover { background: #eff6ff; }
        .row-green { background: #f0fdf4; }
        .row-green:hover { background: #eff6ff; }
        .row-orange-light { background: #fed7aa; }
        .row-orange-light:hover { background: #fef3c7; }
        .row-orange { background: white; }
        .row-orange:hover { background: #fef3c7; }
        .row-red { background: #fef2f2; }
        .row-red:hover { background: #fee2e2; }
        
        .marker-2 { border-bottom: 3px solid #1f2937 !important; }
        
        footer { text-align: center; padding: 20px; color: #9ca3af; font-size: 12px; margin-top: 40px; border-top: 1px solid #e5e7eb; }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Dive Tables Index</h1>
            <p class="subtitle">Browse all dive tables organized by type and category</p>
        </header>
        
        <div id="content"></div>
        
        <footer>DivePlan Tables Widget v1.0 | All CSV data embedded | Offline ready</footer>
    </div>

    <script>
        const app = {
            tablesData: [
                {
                    name: "No-Stop Limits for Air Diving",
                    tag: "No Stops Air",
                    tagClass: "tag-blue",
                    children: [
                        { name: "Air diving, no-stop limits in minutes", code: "ND15" },
                        { name: "No-Stop Limits for Air Diving Extended", code: "LND15" }
                    ]
                },
                {
                    name: "Standard Air Tables",
                    tag: "Standard Air",
                    tagClass: "tag-cyan",
                    children: [
                        { name: "Repetitive Interval 12 Hours", code: "SIL15", depths: [12,15,18,21,24,27,30,33,36,39,42,45,48,51] },
                        { name: "Repetitive Interval 2 Hours", code: "H2SIL15", depths: [12,15,18,21,24,27,30,33,36,39,42,45,48,51] },
                        { name: "Repetitive Interval 4 Hours", code: "H4SIL15", depths: [12,15,18,21,24,27,30,33,36,39,42,45,48,51] }
                    ]
                },
                {
                    name: "Surface/OX Tables",
                    tag: "SurD O2",
                    tagClass: "tag-orange",
                    children: [
                        { name: "Repetitive Interval 12 Hours", code: "SOX15", depths: [12,15,18,21,24,27,30,33,36,39,42,45,48,51] },
                        { name: "Repetitive Interval 4 Hours", code: "HSOX15", depths: [12,15,18,21,24,27,30,33,36,39,42,45,48,51] }
                    ]
                },
                {
                    name: "Backup Air Tables",
                    tag: "Backup Air",
                    tagClass: "tag-yellow",
                    children: [
                        { name: "Backup Air – Repetitive Interval 12 Hours", code: "SAB15", depths: [12,15,18,21,24,27,30,33,36,39,42,45,48,51] },
                        { name: "Backup Air – Repetitive Interval 4 Hours", code: "HSAB15", depths: [12,15,18,21,24,27,30,33,36,39,42,45,48,51] }
                    ]
                },
                {
                    name: "Nitrox Decompression Tables",
                    tag: "Nitrox",
                    tagClass: "tag-green",
                    children: [
                        { name: "Nitrox 40/60 Repetitive Interval 12 Hours", code: "NIA15", depths: [18,21,24,27] },
                        { name: "Nitrox 40/60 Repetitive Interval 2 Hours", code: "H2NIA15", depths: [18,21,24,27] },
                        { name: "Nitrox 40/60 Repetitive Interval 4 Hours", code: "H4NIA15", depths: [18,21,24,27] },
                        { name: "Nitrox 35/65 Repetitive Interval 12 Hours", code: "NIB15", depths: [18,21,24,27,30,33] },
                        { name: "Nitrox 35/65 Repetitive Interval 2 Hours", code: "H2NIB15", depths: [18,21,24,27,30,33] },
                        { name: "Nitrox 35/65 Repetitive Interval 4 Hours", code: "H4NIB15", depths: [18,21,24,27,30,33] }
                    ]
                },
                {
                    name: "Wet or Dry Bell Air/Oxygen Tables",
                    tag: "Wet/Dry Bell",
                    tagClass: "tag-indigo",
                    children: [
                        { name: "Bell Air/Oxygen Decompression", code: "BOX15", depths: [12,15,18,21,24,27,30,33,36,39,42,45,48,51] }
                    ]
                }
            ],
            
            csvData: {
                'SIL15': [
                    { depth: 12, time: 120, till1st: 0.9, d24: '', d21: '', d18: '', d15: '', d12: '', d9: '', d6: '1', d3: '2.2', deco: 21, otu: '', esot: '', marker: 0 },
                    { depth: 12, time: 130, till1st: 0.9, d24: '', d21: '', d18: '', d15: '', d12: '', d9: '', d6: '3', d3: '4.2', deco: 23, otu: '', esot: '', marker: 0 },
                    { depth: 12, time: 140, till1st: 0.9, d24: '', d21: '', d18: '', d15: '', d12: '', d9: '', d6: '5', d3: '6.2', deco: 24, otu: '', esot: '', marker: 0 },
                    { depth: 12, time: 150, till1st: 0.9, d24: '', d21: '', d18: '', d15: '', d12: '', d9: '', d6: '6', d3: '7.2', deco: 26, otu: '', esot: '', marker: 0 },
                    { depth: 12, time: 160, till1st: 0.9, d24: '', d21: '', d18: '', d15: '', d12: '', d9: '', d6: '7', d3: '8.2', deco: 28, otu: '', esot: '', marker: 0 },
                    { depth: 12, time: 170, till1st: 0.9, d24: '', d21: '', d18: '', d15: '', d12: '', d9: '', d6: '9', d3: '10.2', deco: 30, otu: '', esot: '', marker: 0 },
                    { depth: 12, time: 180, till1st: 0.9, d24: '', d21: '', d18: '', d15: '', d12: '', d9: '', d6: '13', d3: '14.2', deco: 32, otu: '', esot: '', marker: 3 },
                    { depth: 15, time: 70, till1st: 1.2, d24: '', d21: '', d18: '', d15: '', d12: '', d9: '', d6: '2', d3: '3.5', deco: 6, otu: '16', esot: '', marker: 0 },
                    { depth: 15, time: 80, till1st: 1.2, d24: '', d21: '', d18: '', d15: '', d12: '', d9: '', d6: '7', d3: '8.5', deco: 7, otu: '19', esot: '', marker: 0 },
                    { depth: 15, time: 90, till1st: 1.2, d24: '', d21: '', d18: '', d15: '', d12: '', d9: '', d6: '11', d3: '12.5', deco: 7, otu: '21', esot: '', marker: 0 },
                    { depth: 15, time: 100, till1st: 1.2, d24: '', d21: '', d18: '', d15: '', d12: '', d9: '', d6: '14', d3: '15.5', deco: 8, otu: '24', esot: '', marker: 0 },
                    { depth: 15, time: 110, till1st: 1.2, d24: '', d21: '', d18: '', d15: '', d12: '', d9: '', d6: '17', d3: '18.5', deco: 9, otu: '26', esot: '', marker: 0 },
                    { depth: 15, time: 120, till1st: 1.2, d24: '', d21: '', d18: '', d15: '', d12: '', d9: '', d6: '19', d3: '20.5', deco: 10, otu: '29', esot: '', marker: 0 },
                    { depth: 15, time: 130, till1st: 1.2, d24: '', d21: '', d18: '', d15: '', d12: '', d9: '', d6: '24', d3: '25.5', deco: 11, otu: '31', esot: '', marker: 0 },
                    { depth: 15, time: 140, till1st: 1.2, d24: '', d21: '', d18: '', d15: '', d12: '', d9: '', d6: '31', d3: '32.5', deco: 12, otu: '34', esot: '', marker: 2 },
                    { depth: 15, time: 150, till1st: 1.2, d24: '', d21: '', d18: '', d15: '', d12: '', d9: '', d6: '36', d3: '37.5', deco: 12, otu: '36', esot: '', marker: 0 },
                    { depth: 15, time: 160, till1st: 1.2, d24: '', d21: '', d18: '', d15: '', d12: '', d9: '', d6: '41', d3: '42.5', deco: 13, otu: '39', esot: '', marker: 0 },
                    { depth: 15, time: 170, till1st: 1.2, d24: '', d21: '', d18: '', d15: '', d12: '', d9: '', d6: '45', d3: '46.5', deco: 14, otu: '42', esot: '', marker: 0 },
                    { depth: 15, time: 180, till1st: 1.2, d24: '', d21: '', d18: '', d15: '', d12: '', d9: '', d6: '49', d3: '50.5', deco: 15, otu: '44', esot: '', marker: 3 }
                ],
                'H2NIA15': [
                    { depth: 18, time: 90, till1st: 1.5, d24: '', d21: '', d18: '', d15: '', d12: '', d9: '', d6: '1', d3: '2.8', deco: 109, otu: '119', esot: '', marker: 0 },
                    { depth: 18, time: 100, till1st: 1.5, d24: '', d21: '', d18: '', d15: '', d12: '', d9: '', d6: '3', d3: '4.8', deco: 121, otu: '133', esot: '', marker: 1 },
                    { depth: 18, time: 110, till1st: 1.5, d24: '', d21: '', d18: '', d15: '', d12: '', d9: '', d6: '7', d3: '8.8', deco: 133, otu: '147', esot: '', marker: 0 },
                    { depth: 18, time: 120, till1st: 1.5, d24: '', d21: '', d18: '', d15: '', d12: '', d9: '', d6: '11', d3: '12.8', deco: 145, otu: '160', esot: '', marker: 1 },
                    { depth: 18, time: 130, till1st: 1.5, d24: '', d21: '', d18: '', d15: '', d12: '', d9: '', d6: '15', d3: '16.8', deco: 158, otu: '174', esot: '', marker: 0 },
                    { depth: 18, time: 140, till1st: 1.5, d24: '', d21: '', d18: '', d15: '', d12: '', d9: '', d6: '19', d3: '20.8', deco: 170, otu: '188', esot: '', marker: 1 },
                    { depth: 18, time: 150, till1st: 1.5, d24: '', d21: '', d18: '', d15: '', d12: '', d9: '', d6: '23', d3: '24.8', deco: 182, otu: '202', esot: '', marker: 3 }
                ]
            },
            
            state: { level: 1, l1Index: null, l2Index: null },
            
            init() {
                this.render();
            },
            
            render() {
                const content = document.getElementById('content');
                
                if (this.state.level === 1) {
                    this.renderLevel1();
                } else if (this.state.level === 2) {
                    this.renderLevel2();
                } else if (this.state.level === 3) {
                    this.renderLevel3();
                } else if (this.state.level === 4) {
                    this.renderTable();
                }
            },
            
            renderLevel1() {
                let html = '<div class="grid">';
                this.tablesData.forEach((cat, idx) => {
                    html += `<div class="card" onclick="app.selectL1(${idx})">
                        <div class="tag ${cat.tagClass}">${cat.tag}</div>
                        <h3>${cat.name}</h3>
                        <p>${cat.children.length} table${cat.children.length !== 1 ? 's' : ''}</p>
                    </div>`;
                });
                html += '</div>';
                document.getElementById('content').innerHTML = html;
            },
            
            renderLevel2() {
                const cat = this.tablesData[this.state.l1Index];
                let html = `<button class="back-btn" onclick="app.selectL1(null)">← Back</button><div class="grid">`;
                cat.children.forEach((table, idx) => {
                    html += `<div class="card" onclick="app.selectL2(${idx})">
                        <div class="tag ${cat.tagClass}">${cat.tag}</div>
                        <h3>${table.name}</h3>
                        <div class="code">Code: ${table.code}</div>
                        ${table.depths ? `<div class="depths">${table.depths.length} depth${table.depths.length !== 1 ? 's' : ''}</div>` : '<div class="depths">Reference table</div>'}
                    </div>`;
                });
                html += '</div>';
                document.getElementById('content').innerHTML = html;
            },
            
            renderLevel3() {
                const cat = this.tablesData[this.state.l1Index];
                const table = cat.children[this.state.l2Index];
                let html = `<button class="back-btn" onclick="app.selectL2(null)">← Back</button>`;
                html += `<div class="section"><h2>${table.name}</h2><p>Code: <strong>${table.code}</strong></p></div>`;
                html += '<div class="depths-grid">';
                table.depths.forEach(d => {
                    html += `<button class="depth-btn" onclick="app.selectDepth(${d})">${d}m</button>`;
                });
                html += '</div>';
                document.getElementById('content').innerHTML = html;
            },
            
            renderTable() {
                const cat = this.tablesData[this.state.l1Index];
                const table = cat.children[this.state.l2Index];
                const depth = this.currentDepth;
                const csv = this.csvData[table.code] || [];
                const rows = csv.filter(r => r.depth === depth);
                
                let html = `<button class="back-btn" onclick="app.selectDepth(null)">← Back</button>`;
                html += `<div class="table-wrapper"><div class="table-header"><h2>${table.name} - ${depth}m</h2></div>`;
                html += '<div class="table-scroll"><table><thead><tr><th>Dive Time<br>(min)</th><th>Till 1st<br>Stop</th><th colspan="8">Stop Depth (metres)</th><th>Tot. Deco<br>Time (min)</th><th>Tot.<br>OTU</th><th>Tot.<br>ESOT</th></tr>';
                html += '<tr><th></th><th></th><th>24m</th><th>21m</th><th>18m</th><th>15m</th><th>12m</th><th>9m</th><th>6m</th><th>3m</th><th></th><th></th><th></th></tr></thead><tbody>';
                
                rows.forEach((row, idx) => {
                    const isLast = idx === rows.length - 1;
                    const isRef = table.code === 'ND15' || table.code === 'LND15';
                    let rowClass = 'row-white';
                    if (isRef) {
                        rowClass = idx % 2 === 0 ? 'row-orange-light' : 'row-orange';
                    } else {
                        if (isLast) rowClass = 'row-red';
                        else rowClass = idx % 2 === 0 ? 'row-white' : 'row-green';
                    }
                    if (row.marker === 2) rowClass += ' marker-2';
                    
                    html += `<tr class="${rowClass}"><td><strong>${row.time}</strong></td><td>${row.till1st}</td>`;
                    html += `<td>${row.d24 || '—'}</td><td>${row.d21 || '—'}</td><td>${row.d18 || '—'}</td><td>${row.d15 || '—'}</td>`;
                    html += `<td>${row.d12 || '—'}</td><td>${row.d9 || '—'}</td><td>${row.d6}</td><td>${row.d3}</td>`;
                    html += `<td>${row.deco}</td><td>${row.otu || '—'}</td><td>${row.esot || '—'}</td></tr>`;
                });
                
                html += '</tbody></table></div></div>';
                document.getElementById('content').innerHTML = html;
            },
            
            selectL1(idx) {
                if (idx === null) {
                    this.state = { level: 1, l1Index: null, l2Index: null };
                } else {
                    this.state = { level: 2, l1Index: idx, l2Index: null };
                }
                this.render();
            },
            
            selectL2(idx) {
                if (idx === null) {
                    this.state = { level: 2, l1Index: this.state.l1Index, l2Index: null };
                } else {
                    this.state = { level: 3, l1Index: this.state.l1Index, l2Index: idx };
                }
                this.render();
            },
            
            selectDepth(depth) {
                if (depth === null) {
                    this.state = { level: 3, l1Index: this.state.l1Index, l2Index: this.state.l2Index };
                } else {
                    this.currentDepth = depth;
                    this.state = { level: 4, l1Index: this.state.l1Index, l2Index: this.state.l2Index };
                }
                this.render();
            }
        };
        
        window.addEventListener('load', () => app.init());
    </script>
</body>
</html>
