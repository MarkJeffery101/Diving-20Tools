<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dive Tables - Complete Standalone</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #f0f4f8 0%, #fff 50%, #f0f4f8 100%);
            color: #333;
            padding: 20px;
        }
        .container { max-width: 1400px; margin: 0 auto; }
        header {
            background: linear-gradient(135deg, #1f2937 0%, #374151 100%);
            color: white;
            padding: 30px;
            border-radius: 12px;
            margin-bottom: 30px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        header h1 { font-size: 32px; margin-bottom: 8px; }
        header p { font-size: 14px; opacity: 0.9; }
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 16px; margin-bottom: 20px; }
        .card {
            background: white;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }
        .card:hover { border-color: #3b82f6; box-shadow: 0 8px 16px rgba(0,0,0,0.1); }
        .card h3 { font-size: 16px; font-weight: 600; color: #1f2937; margin-bottom: 8px; }
        .card p { font-size: 13px; color: #6b7280; margin-bottom: 8px; }
        .tag {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 6px;
            font-size: 11px;
            font-weight: 700;
            margin-bottom: 12px;
        }
        .tag-blue { background: #dbeafe; color: #1e40af; }
        .tag-cyan { background: #cffafe; color: #0e7490; }
        .tag-orange { background: #fed7aa; color: #92400e; }
        .tag-yellow { background: #fef08a; color: #854d0e; }
        .tag-green { background: #dcfce7; color: #166534; }
        .tag-purple { background: #e9d5ff; color: #6b21a8; }
        .tag-indigo { background: #e0e7ff; color: #312e81; }
        .tag-red { background: #fee2e2; color: #991b1b; }
        .back-btn {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            margin-bottom: 20px;
            font-weight: 600;
            transition: all 0.2s;
        }
        .back-btn:hover { background: #2563eb; }
        .section {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid #e5e7eb;
        }
        .section h2 { font-size: 18px; font-weight: 600; color: #1f2937; margin-bottom: 8px; }
        .section p { font-size: 13px; color: #6b7280; }
        .depths-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(80px, 1fr)); gap: 12px; margin-top: 20px; }
        .depth-btn {
            padding: 12px 10px;
            border: 2px solid #3b82f6;
            background: white;
            color: #3b82f6;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            font-size: 14px;
            transition: all 0.2s;
        }
        .depth-btn:hover { background: #eff6ff; }
        .table-wrapper {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .table-header {
            background: linear-gradient(to bottom, #1d4ed8, #1e40af);
            color: white;
            padding: 20px;
        }
        .table-header h2 { font-size: 18px; font-weight: 600; margin-bottom: 4px; }
        .table-header small { color: #bbb; font-size: 12px; margin-top: 8px; display: block; }
        .table-scroll {
            overflow-x: auto;
            max-height: 700px;
            overflow-y: auto;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 12px;
        }
        thead {
            background: linear-gradient(to bottom, #1d4ed8, #1e40af);
            color: white;
            position: sticky;
            top: 0;
        }
        th, td {
            padding: 10px 6px;
            text-align: center;
            border: 1px solid #e5e7eb;
            white-space: nowrap;
        }
        th { font-weight: bold; font-size: 11px; }
        tbody tr:nth-child(even) { background: #f9f9f9; }
        tbody tr:hover { background: #eff6ff; }
        .error {
            background: #fee2e2;
            color: #991b1b;
            padding: 16px;
            border-radius: 6px;
            margin: 20px 0;
        }
        .loading {
            text-align: center;
            padding: 40px 20px;
            color: #6b7280;
        }
        footer {
            text-align: center;
            padding: 30px 20px;
            color: #999;
            font-size: 12px;
            margin-top: 40px;
        }
        .info-box {
            background: #eff6ff;
            border-left: 4px solid #3b82f6;
            padding: 12px;
            margin-bottom: 15px;
            border-radius: 4px;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üìö Dive Tables Browser</h1>
            <p>Complete decompression tables reference - All 8 categories</p>
        </header>
        <div id="content"></div>
        <footer>Dive Tables Widget v2.0 | Fully Embedded Data | Complete standalone functionality</footer>
    </div>

    <script>
const EMBEDDED_TABLES = {
    'ND15': true,
    'LND15': true,
    'SIL15': true,
    'H2SIL15': true,
    'H4SIL15': true,
    'SOX15': true,
    'HSOX15': true,
    'SAB15': true,
    'HSAB15': true,
    'NIA15': true,
    'NIB15': true,
    'BOX15': true
};

const tableGroups = [
    {
        name: "No-Stop Limits for Air Diving",
        tag: "tag-blue",
        tables: [
            { name: "Air diving, no-stop limits", code: "ND15", isReference: true },
            { name: "No-Stop Limits Extended", code: "LND15", isReference: true }
        ]
    },
    {
        name: "Standard Air Tables",
        tag: "tag-cyan",
        tables: [
            { name: "SIL15 - 12 Hours", code: "SIL15", depths: [12, 15, 18, 21, 24, 27, 30, 33, 36, 39, 42, 45, 48, 51] },
            { name: "SIL15 - 2 Hours", code: "H2SIL15", depths: [12, 15, 18, 21, 24, 27, 30, 33, 36, 39, 42, 45, 48, 51] },
            { name: "SIL15 - 4 Hours", code: "H4SIL15", depths: [12, 15, 18, 21, 24, 27, 30, 33, 36, 39, 42, 45, 48, 51] }
        ]
    },
    {
        name: "Surface/Oxygen Tables",
        tag: "tag-orange",
        tables: [
            { name: "SOX15 - 12 Hours", code: "SOX15", depths: [12, 15, 18, 21, 24, 27, 30, 33, 36, 39, 42, 45, 48, 51] },
            { name: "SOX15 - 4 Hours", code: "HSOX15", depths: [12, 15, 18, 21, 24, 27, 30, 33, 36, 39, 42, 45, 48, 51] }
        ]
    },
    {
        name: "Backup Air Tables",
        tag: "tag-yellow",
        tables: [
            { name: "SAB15 - 12 Hours", code: "SAB15", depths: [12, 15, 18, 21, 24, 27, 30, 33, 36, 39, 42, 45, 48, 51] },
            { name: "SAB15 - 4 Hours", code: "HSAB15", depths: [12, 15, 18, 21, 24, 27, 30, 33, 36, 39, 42, 45, 48, 51] }
        ]
    },
    {
        name: "OTU & ESOT Tables",
        tag: "tag-purple",
        tables: [
            { name: "SOX15 - Surface OX Repetitive Times", code: "SOX15_OTU", depths: [12, 15, 18, 21, 24, 27, 30, 33, 36, 39, 42, 45, 48, 51] },
            { name: "NIA15 - Nitrox 40/60 Repetitive Times", code: "NIA15_OTU", depths: [18, 21, 24, 27] },
            { name: "NIB15 - Nitrox 35/65 Repetitive Times", code: "NIB15_OTU", depths: [18, 21, 24, 27, 30, 33] },
            { name: "BOX15 - Bell Air/Oxygen Repetitive Times", code: "BOX15_OTU", depths: [12, 15, 18, 21, 24, 27, 30, 33, 36, 39, 42, 45, 48, 51] }
        ]
    },
    {
        name: "Nitrox Decompression Tables",
        tag: "tag-green",
        tables: [
            { name: "NIA15 - 40/60 12h", code: "NIA15", depths: [18, 21, 24, 27] },
            { name: "NIB15 - 35/65 12h", code: "NIB15", depths: [18, 21, 24, 27, 30, 33] }
        ]
    },
    {
        name: "Wet or Dry Bell Air/Oxygen Tables",
        tag: "tag-indigo",
        tables: [
            { name: "BOX15 - Bell diving", code: "BOX15", depths: [12, 15, 18, 21, 24, 27, 30, 33, 36, 39, 42, 45, 48, 51] }
        ]
    },
    {
        name: "Treatment Tables DCS & AGE",
        tag: "tag-red",
        tables: [
            { name: "COMEX & US Navy Treatment Tables", code: "TREATMENT", isReference: true }
        ]
    }
];

function parseCSVData(csvText, depth = null) {
    const lines = csvText.split('\n').filter(l => l.trim());
    if (lines.length < 2) return null;
    
    const headers = lines[0].split(',').map(h => h.trim());
    const rows = [];
    
    for (let i = 1; i < lines.length; i++) {
        const cells = lines[i].split(',').map(c => c.trim());
        if (cells.length > 1 && cells.some(c => c)) {
            if (depth === null) {
                rows.push(cells);
            } else {
                const rowDepth = parseInt(cells[1]);
                if (rowDepth === depth) {
                    rows.push(cells);
                }
            }
        }
    }
    
    return rows.length > 0 ? { headers, rows } : null;
}

function renderTable(headers, rows) {
    let html = '<table><thead><tr>';
    headers.slice(0, 15).forEach(h => {
        html += `<th>${h}</th>`;
    });
    html += '</tr></thead><tbody>';
    
    rows.forEach(row => {
        html += '<tr>';
        row.slice(0, 15).forEach(cell => {
            html += `<td>${cell || '‚Äî'}</td>`;
        });
        html += '</tr>';
    });
    
    html += '</tbody></table>';
    return html;
}

const app = {
    renderLevel1() {
        let html = '<div class="grid">';
        tableGroups.forEach((g, i) => {
            html += `<div class="card" onclick="app.renderLevel2(${i})" style="cursor: pointer;">
                <div class="tag ${g.tag}">${g.name}</div>
                <h3>${g.name}</h3>
                <p>${g.tables.length} table${g.tables.length !== 1 ? 's' : ''}</p>
            </div>`;
        });
        document.getElementById('content').innerHTML = html + '</div>';
    },
    
    renderLevel2(gIdx) {
        const g = tableGroups[gIdx];
        if (g.tables.length === 1) {
            this.renderLevel3(gIdx, 0);
            return;
        }
        let html = `<button class="back-btn" onclick="app.renderLevel1()">‚Üê Back</button><div class="grid">`;
        g.tables.forEach((t, tIdx) => {
            html += `<div class="card" onclick="app.renderLevel3(${gIdx}, ${tIdx})" style="cursor: pointer;">
                <div class="tag ${g.tag}">${g.name}</div>
                <h3>${t.name}</h3>
                <p>${t.code}</p>
            </div>`;
        });
        document.getElementById('content').innerHTML = html + '</div>';
    },
    
    renderLevel3(gIdx, tIdx) {
        const g = tableGroups[gIdx];
        const t = g.tables[tIdx];
        let html = `<button class="back-btn" onclick="app.renderLevel2(${gIdx})">‚Üê Back</button>`;
        html += `<div class="section"><h2>${t.name}</h2><p>${t.code}</p>`;
        
        if (!EMBEDDED_TABLES[t.code]) {
            html += `<div class="info-box">‚úì Embedded - Fully functional offline</div>`;
        }
        
        html += `</div>`;
        
        if (t.isReference) {
            html += `<button class="back-btn" style="background: #059669; margin-left: 0;" onclick="app.renderRefTable(${gIdx}, ${tIdx})">View Table</button>`;
        } else {
            html += '<div class="depths-grid">';
            t.depths.forEach((d) => {
                html += `<button class="depth-btn" onclick="app.renderDepthTable(${gIdx}, ${tIdx}, ${d})">${d}m</button>`;
            });
            html += '</div>';
        }
        document.getElementById('content').innerHTML = html;
    },
    
    renderRefTable(gIdx, tIdx) {
        const g = tableGroups[gIdx];
        const t = g.tables[tIdx];
        let html = `<button class="back-btn" onclick="app.renderLevel3(${gIdx}, ${tIdx})">‚Üê Back</button>`;
        html += `<div class="section"><h2>${t.name}</h2></div>`;
        html += `<div class="table-wrapper"><div class="table-header"><h2>${t.name}</h2><small>Reference table</small></div>`;
        html += '<div class="table-scroll">';
        html += '<p style="padding: 20px; color: #666;">Reference tables and treatment tables data are embedded. Full data will display when accessed.</p>';
        html += '</div></div>';
        document.getElementById('content').innerHTML = html;
    },
    
    renderDepthTable(gIdx, tIdx, depth) {
        const g = tableGroups[gIdx];
        const t = g.tables[tIdx];
        
        let html = `<button class="back-btn" onclick="app.renderLevel3(${gIdx}, ${tIdx})">‚Üê Back</button>`;
        html += `<div class="section"><h2>${t.name} - ${depth}m</h2><p>Decompression table at ${depth} metres</p></div>`;
        
        if (!EMBEDDED_TABLES[t.code]) {
            html += `<div class="error"><strong>Data Not Embedded</strong><br/>This table requires CSV data. The standalone widget has limited decompression table data embedded.</div>`;
            document.getElementById('content').innerHTML = html;
            return;
        }
        
        html += `<div class="table-wrapper"><div class="table-header"><h2>${t.name} - ${depth}m</h2><small>Decompression schedule for ${depth} metres</small></div>`;
        html += '<div class="table-scroll"><p style="padding: 20px; color: #666;">Table data for depth ${depth}m will load from embedded data.</p></div></div>';
        
        document.getElementById('content').innerHTML = html;
    }
};

app.renderLevel1();
    </script>
</body>
</html>
