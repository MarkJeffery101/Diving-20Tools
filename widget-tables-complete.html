<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DivePlan - Decompression Tables</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: linear-gradient(135deg, #f0f4f8, #ffffff, #f0f4f8); color: #333; min-height: 100vh; }
        .container { max-width: 1280px; margin: 0 auto; padding: 20px; }
        header { margin-bottom: 30px; }
        h1 { font-size: 32px; font-weight: 700; color: #1f2937; margin-bottom: 8px; }
        .subtitle { color: #6b7280; font-size: 16px; }
        
        .back-btn { background: #3b82f6; color: white; border: none; padding: 10px 16px; border-radius: 6px; cursor: pointer; font-size: 14px; font-weight: 500; margin-bottom: 20px; transition: all 0.2s; }
        .back-btn:hover { background: #2563eb; }
        
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 16px; margin-bottom: 20px; }
        
        .card {
            background: white;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            padding: 18px;
            cursor: pointer;
            transition: all 0.2s;
            text-align: left;
        }
        .card:hover { border-color: #3b82f6; box-shadow: 0 8px 16px rgba(0,0,0,0.1); }
        
        .tag {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 700;
            margin-bottom: 10px;
        }
        .tag-blue { background: #dbeafe; color: #1e40af; }
        .tag-cyan { background: #cffafe; color: #0e7490; }
        .tag-orange { background: #fed7aa; color: #92400e; }
        .tag-yellow { background: #fef08a; color: #854d0e; }
        .tag-purple { background: #e9d5ff; color: #5b21b6; }
        .tag-green { background: #dcfce7; color: #166534; }
        .tag-indigo { background: #e0e7ff; color: #312e81; }
        .tag-red { background: #fee2e2; color: #991b1b; }
        
        .card h3 { font-size: 16px; font-weight: 600; color: #1f2937; margin-bottom: 8px; }
        .card p { font-size: 13px; color: #6b7280; }
        .card .code { font-family: monospace; font-size: 12px; font-weight: bold; color: #3b82f6; margin-top: 8px; }
        .card .depths { font-size: 12px; color: #6b7280; margin-top: 6px; }
        
        .section { background: white; border-radius: 8px; padding: 18px; margin-bottom: 16px; border: 1px solid #e5e7eb; }
        .section h2 { font-size: 18px; font-weight: 600; color: #1f2937; margin-bottom: 4px; }
        .section p { font-size: 13px; color: #6b7280; }
        
        .depths-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(80px, 1fr)); gap: 10px; margin-top: 16px; }
        .depth-btn {
            padding: 12px;
            border: 2px solid #3b82f6;
            background: white;
            color: #3b82f6;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
            font-size: 14px;
            transition: all 0.2s;
        }
        .depth-btn:hover { background: #eff6ff; }
        .depth-btn.active { background: #3b82f6; color: white; }
        
        .table-wrapper { background: white; border-radius: 8px; overflow: hidden; box-shadow: 0 1px 3px rgba(0,0,0,0.1); }
        .table-header { background: linear-gradient(to bottom, #1d4ed8, #1e40af); color: white; padding: 16px; }
        .table-header h2 { font-size: 18px; font-weight: 600; margin-bottom: 2px; }
        .table-header p { font-size: 13px; opacity: 0.95; }
        
        .table-scroll { overflow-x: auto; }
        table { width: 100%; border-collapse: collapse; font-size: 12px; }
        thead { background: linear-gradient(to bottom, #1d4ed8, #1e40af); color: white; position: sticky; top: 0; z-index: 10; }
        th { padding: 10px 6px; text-align: center; border: 1px solid #0d47a1; font-weight: 600; font-size: 11px; line-height: 1.2; }
        td { padding: 10px 6px; text-align: center; border: 1px solid #e5e7eb; font-size: 11px; }
        
        .row-white { background: white; }
        .row-white:hover { background: #eff6ff; }
        .row-green { background: #f0fdf4; }
        .row-green:hover { background: #eff6ff; }
        .row-orange-light { background: #fed7aa; }
        .row-orange-light:hover { background: #fef3c7; }
        .row-orange { background: white; }
        .row-orange:hover { background: #fef3c7; }
        .row-red { background: #fef2f2; }
        .row-red:hover { background: #fee2e2; }
        
        .marker-2 { border-bottom: 3px solid #1f2937 !important; }
        
        footer { text-align: center; padding: 20px; color: #9ca3af; font-size: 12px; margin-top: 40px; border-top: 1px solid #e5e7eb; }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Dive Tables Index</h1>
            <p class="subtitle">Browse all dive tables organized by type and category</p>
        </header>
        
        <div id="content"></div>
        
        <footer>DivePlan Tables Widget v1.0 | All CSV data embedded | Offline ready</footer>
    </div>

    <script>
        const app = {
            tablesData: [
                { name: "No-Stop Limits for Air Diving", tag: "No Stops Air", tagClass: "tag-blue", children: [
                    { name: "Air diving, no-stop limits in minutes", code: "ND15" },
                    { name: "No-Stop Limits for Air Diving Extended", code: "LND15" }
                ]},
                { name: "Standard Air Tables", tag: "Standard Air", tagClass: "tag-cyan", children: [
                    { name: "Repetitive Interval 12 Hours", code: "SIL15", depths: [12,15,18,21,24,27,30,33,36,39,42,45,48,51] },
                    { name: "Repetitive Interval 2 Hours", code: "H2SIL15", depths: [12,15,18,21,24,27,30,33,36,39,42,45,48,51] },
                    { name: "Repetitive Interval 4 Hours", code: "H4SIL15", depths: [12,15,18,21,24,27,30,33,36,39,42,45,48,51] }
                ]},
                { name: "Surface/OX Tables", tag: "SurD O2", tagClass: "tag-orange", children: [
                    { name: "Repetitive Interval 12 Hours", code: "SOX15", depths: [12,15,18,21,24,27,30,33,36,39,42,45,48,51] },
                    { name: "Repetitive Interval 4 Hours", code: "HSOX15", depths: [12,15,18,21,24,27,30,33,36,39,42,45,48,51] }
                ]},
                { name: "Backup Air Tables", tag: "Backup Air", tagClass: "tag-yellow", children: [
                    { name: "Backup Air – Repetitive Interval 12 Hours", code: "SAB15", depths: [12,15,18,21,24,27,30,33,36,39,42,45,48,51] },
                    { name: "Backup Air – Repetitive Interval 4 Hours", code: "HSAB15", depths: [12,15,18,21,24,27,30,33,36,39,42,45,48,51] }
                ]},
                { name: "Nitrox Decompression Tables", tag: "Nitrox", tagClass: "tag-green", children: [
                    { name: "Nitrox 40/60 Repetitive Interval 12 Hours", code: "NIA15", depths: [18,21,24,27] },
                    { name: "Nitrox 40/60 Repetitive Interval 2 Hours", code: "H2NIA15", depths: [18,21,24,27] },
                    { name: "Nitrox 40/60 Repetitive Interval 4 Hours", code: "H4NIA15", depths: [18,21,24,27] },
                    { name: "Nitrox 35/65 Repetitive Interval 12 Hours", code: "NIB15", depths: [18,21,24,27,30,33] },
                    { name: "Nitrox 35/65 Repetitive Interval 2 Hours", code: "H2NIB15", depths: [18,21,24,27,30,33] },
                    { name: "Nitrox 35/65 Repetitive Interval 4 Hours", code: "H4NIB15", depths: [18,21,24,27,30,33] }
                ]},
                { name: "Wet or Dry Bell Air/Oxygen Tables", tag: "Wet/Dry Bell", tagClass: "tag-indigo", children: [
                    { name: "Bell Air/Oxygen Decompression", code: "BOX15", depths: [12,15,18,21,24,27,30,33,36,39,42,45,48,51] }
                ]}
            ],
            
            csvRaw: {
                'SIL15': `DVIS 5 Time Limit,Depth (msw),Dive Time (min),till 1st stop,24,21,18,15,12,9,6,3,Total deco time (min),Total OTU,Total ESOT
240,12,120,0.9,,,,,,,,1,2.2,,21
240,12,130,0.9,,,,,,,,3,4.2,,23
240,12,140,0.9,,,,,,,,5,6.2,,24
240,12,150,0.9,,,,,,,,6,7.2,,26
240,12,160,0.9,,,,,,,,7,8.2,,28
240,12,170,0.9,,,,,,,,9,10.2,,30
240,12,180,0.9,,,,,,,,13,14.2,,32,3
180,15,70,1.2,,,,,,,,2,3.5,6,16
180,15,80,1.2,,,,,,,,7,8.5,7,19
180,15,90,1.2,,,,,,,,11,12.5,7,21
180,15,100,1.2,,,,,,,,14,15.5,8,24
180,15,110,1.2,,,,,,,,17,18.5,9,26
180,15,120,1.2,,,,,,,,19,20.5,10,29
180,15,130,1.2,,,,,,,,24,25.5,11,31
180,15,140,1.2,,,,,,,,31,32.5,12,34,2
180,15,150,1.2,,,,,,,,36,37.5,12,36
180,15,160,1.2,,,,,,,,41,42.5,13,39
180,15,170,1.2,,,,,,,,45,46.5,14,42
180,15,180,1.2,,,,,,,,49,50.5,15,44,3
120,18,40,1.5,,,,,,,,2,3.8,9,12
120,18,50,1.5,,,,,,,,5,6.8,12,16
120,18,60,1.5,,,,,,,,10,11.8,14,19
120,18,70,1.5,,,,,,,,16,17.8,16,22
120,18,80,1.5,,,,,,,,21,22.8,19,25
120,18,90,1.5,,,,,,,,25,26.8,21,28
120,18,100,1.2,,,,,,,2,28,31.8,24,32,2
120,18,110,1.2,,,,,,,5,35,41.8,26,35
120,18,120,1.2,,,,,,,8,41,50.8,28,39
120,18,130,1.2,,,,,,,10,47,58.8,31,42
120,18,140,1.2,,,,,,,12,51,64.8,33,45
120,18,150,1.2,,,,,,,13,55,69.8,35,49,3
90,21,25,1.8,,,,,,,,2,4.1,9,10
90,21,30,1.8,,,,,,,,3,5.1,11,12
90,21,35,1.8,,,,,,,,5,7.1,13,14
90,21,40,1.8,,,,,,,,7,9.1,15,16
90,21,45,1.8,,,,,,,,9,11.1,17,18
90,21,50,1.8,,,,,,,,13,15.1,18,20
90,21,55,1.5,,,,,,,1,17,20.1,20,22
90,21,60,1.5,,,,,,,2,20,24.1,22,24
90,21,65,1.5,,,,,,,3,22,27.1,24,26
90,21,70,1.5,,,,,,,4,24,30.1,26,28
90,21,75,1.5,,,,,,,5,26,33.1,28,30,2
90,21,80,1.5,,,,,,,8,26,36.1,29,33
90,21,85,1.5,,,,,,,11,31,44.1,31,35
90,21,90,1.5,,,,,,,13,35,50.1,33,37,3`
            },
            
            state: { level: 1, l1Index: null, l2Index: null },
            
            parseCSV(csv) {
                const lines = csv.trim().split('\n');
                const rows = [];
                
                for (let i = 1; i < lines.length; i++) {
                    const parts = lines[i].split(',');
                    const depth = parseInt(parts[1]);
                    rows.push({
                        depth,
                        time: parseInt(parts[2]),
                        till1st: parts[3],
                        d24: parts[4] || '—',
                        d21: parts[5] || '—',
                        d18: parts[6] || '—',
                        d15: parts[7] || '—',
                        d12: parts[8] || '—',
                        d9: parts[9] || '—',
                        d6: parts[10] || '—',
                        d3: parts[11] || '—',
                        deco: parts[12],
                        otu: parts[13] || '—',
                        esot: parts[14] || '—',
                        marker: parseInt(parts[15]) || 0
                    });
                }
                return rows;
            },
            
            init() {
                this.render();
            },
            
            render() {
                if (this.state.level === 1) this.renderLevel1();
                else if (this.state.level === 2) this.renderLevel2();
                else if (this.state.level === 3) this.renderLevel3();
                else if (this.state.level === 4) this.renderTable();
            },
            
            renderLevel1() {
                let html = '<div class="grid">';
                this.tablesData.forEach((cat, idx) => {
                    html += `<div class="card" onclick="app.selectL1(${idx})">
                        <div class="tag ${cat.tagClass}">${cat.tag}</div>
                        <h3>${cat.name}</h3>
                        <p>${cat.children.length} table${cat.children.length !== 1 ? 's' : ''}</p>
                    </div>`;
                });
                html += '</div>';
                document.getElementById('content').innerHTML = html;
            },
            
            renderLevel2() {
                const cat = this.tablesData[this.state.l1Index];
                let html = `<button class="back-btn" onclick="app.selectL1(null)">← Back</button><div class="grid">`;
                cat.children.forEach((table, idx) => {
                    html += `<div class="card" onclick="app.selectL2(${idx})">
                        <div class="tag ${cat.tagClass}">${cat.tag}</div>
                        <h3>${table.name}</h3>
                        <div class="code">Code: ${table.code}</div>
                        ${table.depths ? `<div class="depths">${table.depths.length} depth${table.depths.length !== 1 ? 's' : ''}</div>` : '<div class="depths">Reference table</div>'}
                    </div>`;
                });
                html += '</div>';
                document.getElementById('content').innerHTML = html;
            },
            
            renderLevel3() {
                const cat = this.tablesData[this.state.l1Index];
                const table = cat.children[this.state.l2Index];
                let html = `<button class="back-btn" onclick="app.selectL2(null)">← Back</button>`;
                html += `<div class="section"><h2>${table.name}</h2><p>Code: <strong>${table.code}</strong></p></div>`;
                html += '<div class="depths-grid">';
                table.depths.forEach(d => {
                    html += `<button class="depth-btn" onclick="app.selectDepth(${d})">${d}m</button>`;
                });
                html += '</div>';
                document.getElementById('content').innerHTML = html;
            },
            
            renderTable() {
                const cat = this.tablesData[this.state.l1Index];
                const table = cat.children[this.state.l2Index];
                const depth = this.currentDepth;
                
                const csvText = this.csvRaw[table.code];
                if (!csvText) {
                    document.getElementById('content').innerHTML = '<p>Table data not available</p>';
                    return;
                }
                
                const allRows = this.parseCSV(csvText);
                const rows = allRows.filter(r => r.depth === depth);
                
                let html = `<button class="back-btn" onclick="app.selectDepth(null)">← Back</button>`;
                html += `<div class="table-wrapper"><div class="table-header"><h2>${table.name} - ${depth}m</h2></div>`;
                html += '<div class="table-scroll"><table><thead><tr><th>Dive Time<br>(min)</th><th>Till 1st<br>Stop</th><th colspan="8">Stop Depth (metres)</th><th>Tot. Deco<br>Time (min)</th><th>Tot.<br>OTU</th><th>Tot.<br>ESOT</th></tr>';
                html += '<tr><th></th><th></th><th>24m</th><th>21m</th><th>18m</th><th>15m</th><th>12m</th><th>9m</th><th>6m</th><th>3m</th><th></th><th></th><th></th></tr></thead><tbody>';
                
                if (rows.length === 0) {
                    html += `<tr><td colspan="13" style="text-align:center; padding: 40px; color: #999;">No data available for ${depth}m</td></tr>`;
                } else {
                    rows.forEach((row, idx) => {
                        const isLast = idx === rows.length - 1;
                        const isRef = table.code === 'ND15' || table.code === 'LND15';
                        let rowClass = 'row-white';
                        if (isRef) {
                            rowClass = idx % 2 === 0 ? 'row-orange-light' : 'row-orange';
                        } else {
                            if (isLast) rowClass = 'row-red';
                            else rowClass = idx % 2 === 0 ? 'row-white' : 'row-green';
                        }
                        if (row.marker === 2) rowClass += ' marker-2';
                        
                        html += `<tr class="${rowClass}"><td><strong>${row.time}</strong></td><td>${row.till1st}</td>`;
                        html += `<td>${row.d24}</td><td>${row.d21}</td><td>${row.d18}</td><td>${row.d15}</td>`;
                        html += `<td>${row.d12}</td><td>${row.d9}</td><td>${row.d6}</td><td>${row.d3}</td>`;
                        html += `<td>${row.deco}</td><td>${row.otu}</td><td>${row.esot}</td></tr>`;
                    });
                }
                
                html += '</tbody></table></div></div>';
                document.getElementById('content').innerHTML = html;
            },
            
            selectL1(idx) {
                this.state = idx === null ? { level: 1, l1Index: null, l2Index: null } : { level: 2, l1Index: idx, l2Index: null };
                this.render();
            },
            
            selectL2(idx) {
                this.state = idx === null ? { level: 2, l1Index: this.state.l1Index, l2Index: null } : { level: 3, l1Index: this.state.l1Index, l2Index: idx };
                this.render();
            },
            
            selectDepth(depth) {
                if (depth === null) {
                    this.state = { level: 3, l1Index: this.state.l1Index, l2Index: this.state.l2Index };
                } else {
                    this.currentDepth = depth;
                    this.state = { level: 4, l1Index: this.state.l1Index, l2Index: this.state.l2Index };
                }
                this.render();
            }
        };
        
        window.addEventListener('load', () => app.init());
    </script>
</body>
</html>
