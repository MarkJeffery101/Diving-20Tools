<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>DivePlan Tables Widget</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto;
        background: linear-gradient(135deg, #f0f4f8, #fff, #f0f4f8);
        color: #333;
      }
      .container {
        max-width: 1280px;
        margin: 0 auto;
        padding: 20px;
      }
      header {
        margin-bottom: 30px;
      }
      h1 {
        font-size: 32px;
        font-weight: 700;
        color: #1f2937;
      }
      .subtitle {
        color: #6b7280;
      }
      .back-btn {
        background: #3b82f6;
        color: white;
        border: none;
        padding: 10px 16px;
        border-radius: 6px;
        cursor: pointer;
        margin-bottom: 20px;
      }
      .back-btn:hover {
        background: #2563eb;
      }
      .grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
        gap: 16px;
      }
      .card {
        background: white;
        border: 2px solid #e5e7eb;
        border-radius: 8px;
        padding: 18px;
        cursor: pointer;
        transition: all 0.2s;
      }
      .card:hover {
        border-color: #3b82f6;
        box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
      }
      .card h3 {
        font-size: 16px;
        font-weight: 600;
        color: #1f2937;
        margin-bottom: 8px;
      }
      .card p {
        font-size: 13px;
        color: #6b7280;
      }
      .card .tag {
        display: inline-block;
        padding: 4px 10px;
        border-radius: 4px;
        font-size: 11px;
        font-weight: 700;
        margin-bottom: 10px;
      }
      .tag-blue {
        background: #dbeafe;
        color: #1e40af;
      }
      .tag-cyan {
        background: #cffafe;
        color: #0e7490;
      }
      .tag-orange {
        background: #fed7aa;
        color: #92400e;
      }
      .tag-yellow {
        background: #fef08a;
        color: #854d0e;
      }
      .tag-green {
        background: #dcfce7;
        color: #166534;
      }
      .tag-indigo {
        background: #e0e7ff;
        color: #312e81;
      }
      .section {
        background: white;
        border-radius: 8px;
        padding: 18px;
        margin-bottom: 16px;
        border: 1px solid #e5e7eb;
      }
      .section h2 {
        font-size: 18px;
        font-weight: 600;
        color: #1f2937;
      }
      .depths-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
        gap: 10px;
        margin-top: 16px;
      }
      .depth-btn {
        padding: 12px;
        border: 2px solid #3b82f6;
        background: white;
        color: #3b82f6;
        border-radius: 6px;
        cursor: pointer;
        font-weight: bold;
      }
      .depth-btn:hover {
        background: #eff6ff;
      }
      .table-wrapper {
        background: white;
        border-radius: 8px;
        overflow: hidden;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
      }
      .table-header {
        background: linear-gradient(to bottom, #1d4ed8, #1e40af);
        color: white;
        padding: 16px;
      }
      .table-header h2 {
        font-size: 18px;
        font-weight: 600;
        margin-bottom: 2px;
      }
      .table-scroll {
        overflow-x: auto;
      }
      table {
        width: 100%;
        border-collapse: collapse;
        font-size: 12px;
      }
      thead {
        background: linear-gradient(to bottom, #1d4ed8, #1e40af);
        color: white;
        position: sticky;
        top: 0;
      }
      th {
        padding: 10px 6px;
        text-align: center;
        border: 1px solid #0d47a1;
        font-weight: 600;
        font-size: 11px;
      }
      td {
        padding: 10px 6px;
        text-align: center;
        border: 1px solid #e5e7eb;
      }
      .row-white {
        background: white;
      }
      .row-white:hover {
        background: #eff6ff;
      }
      .row-green {
        background: #f0fdf4;
      }
      .row-green:hover {
        background: #eff6ff;
      }
      .row-orange-light {
        background: #fed7aa;
      }
      .row-orange-light:hover {
        background: #fef3c7;
      }
      .row-red {
        background: #fef2f2;
      }
      .row-red:hover {
        background: #fee2e2;
      }
      .marker-2 {
        border-bottom: 3px solid #1f2937 !important;
      }
      footer {
        text-align: center;
        padding: 20px;
        color: #9ca3af;
        font-size: 12px;
        margin-top: 40px;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <header>
        <h1>Dive Tables Index</h1>
        <p class="subtitle">
          Browse all dive tables organized by type and category
        </p>
      </header>
      <div id="content"></div>
      <footer>
        DivePlan Tables Widget | All CSV data embedded | Offline ready
      </footer>
    </div>

    <script>
      const app = {
        tablesData: [
          {
            name: "Standard Air Tables",
            tag: "Air",
            tagClass: "tag-cyan",
            children: [
              {
                name: "12 Hour SI",
                code: "SIL15",
                depths: [12, 15, 18, 21, 24, 27, 30],
              },
              {
                name: "2 Hour SI",
                code: "H2SIL15",
                depths: [12, 15, 18, 21, 24, 27, 30],
              },
            ],
          },
          {
            name: "Surface O2",
            tag: "SurfaceO2",
            tagClass: "tag-orange",
            children: [
              {
                name: "12 Hour SI",
                code: "SOX15",
                depths: [12, 15, 18, 21, 24, 27, 30],
              },
            ],
          },
          {
            name: "Nitrox Tables",
            tag: "Nitrox",
            tagClass: "tag-green",
            children: [
              {
                name: "NIA 40% - 12h",
                code: "NIA15",
                depths: [18, 21, 24, 27],
              },
              {
                name: "NIA 40% - 2h",
                code: "H2NIA15",
                depths: [18, 21, 24, 27],
              },
            ],
          },
        ],

        csvData: {},

        init() {
          // Load embedded CSV data
          this.csvData["SIL15"] = this.loadSIL15CSV();
          this.csvData["H2NIA15"] = this.loadH2NIA15CSV();
          this.renderLevel1();
        },

        loadSIL15CSV() {
          return `DVIS 5 Time Limit,Depth (msw),Dive Time (min),till 1st stop,24,21,18,15,12,9,6,3,Total deco time (min),Total OTU,Total ESOT
240,12,120,0.9,,,,,,,,1,2.2,,21
240,12,130,0.9,,,,,,,,3,4.2,,23
240,12,140,0.9,,,,,,,,5,6.2,,24
240,12,150,0.9,,,,,,,,6,7.2,,26
240,12,160,0.9,,,,,,,,7,8.2,,28
240,12,170,0.9,,,,,,,,9,10.2,,30
240,12,180,0.9,,,,,,,,13,14.2,,32,3
180,15,70,1.2,,,,,,,,2,3.5,6,16
180,15,80,1.2,,,,,,,,7,8.5,7,19
180,15,90,1.2,,,,,,,,11,12.5,7,21
180,15,100,1.2,,,,,,,,14,15.5,8,24
180,15,110,1.2,,,,,,,,17,18.5,9,26
180,15,120,1.2,,,,,,,,19,20.5,10,29
180,15,130,1.2,,,,,,,,24,25.5,11,31
180,15,140,1.2,,,,,,,,31,32.5,12,34,2
180,15,150,1.2,,,,,,,,36,37.5,12,36
180,15,160,1.2,,,,,,,,41,42.5,13,39
180,15,170,1.2,,,,,,,,45,46.5,14,42
180,15,180,1.2,,,,,,,,49,50.5,15,44,3
120,18,40,1.5,,,,,,,,2,3.8,9,12
120,18,50,1.5,,,,,,,,5,6.8,12,16
120,18,60,1.5,,,,,,,,10,11.8,14,19
120,18,70,1.5,,,,,,,,16,17.8,16,22
120,18,80,1.5,,,,,,,,21,22.8,19,25
120,18,90,1.5,,,,,,,,25,26.8,21,28
120,18,100,1.2,,,,,,,2,28,31.8,24,32,2
120,18,110,1.2,,,,,,,5,35,41.8,26,35
120,18,120,1.2,,,,,,,8,41,50.8,28,39
120,18,130,1.2,,,,,,,10,47,58.8,31,42
120,18,140,1.2,,,,,,,12,51,64.8,33,45
120,18,150,1.2,,,,,,,13,55,69.8,35,49,3
90,21,25,1.8,,,,,,,,2,4.1,9,10
90,21,30,1.8,,,,,,,,3,5.1,11,12
90,21,35,1.8,,,,,,,,5,7.1,13,14
90,21,40,1.8,,,,,,,,7,9.1,15,16
90,21,45,1.8,,,,,,,,9,11.1,17,18
90,21,50,1.8,,,,,,,,13,15.1,18,20
90,21,55,1.5,,,,,,,1,17,20.1,20,22
90,21,60,1.5,,,,,,,2,20,24.1,22,24
90,21,65,1.5,,,,,,,3,22,27.1,24,26
90,21,70,1.5,,,,,,,4,24,30.1,26,28
90,21,75,1.5,,,,,,,5,26,33.1,28,30,2
90,21,80,1.5,,,,,,,8,26,36.1,29,33
90,21,85,1.5,,,,,,,11,31,44.1,31,35
90,21,90,1.5,,,,,,,13,35,50.1,33,37,3
70,24,15,2.1,,,,,,,,1,3.4,7,8
70,24,20,2.1,,,,,,,,3,5.4,10,10
70,24,25,2.1,,,,,,,,4,6.4,12,13
70,24,30,1.8,,,,,,,1,6,9.4,15,15
70,24,35,1.8,,,,,,,2,8,12.4,17,18
70,24,40,1.8,,,,,,,2,11,15.4,20,20
70,24,45,1.8,,,,,,,3,16,21.4,22,23
70,24,50,1.8,,,,,,,5,20,27.4,25,25
70,24,55,1.8,,,,,,,6,23,31.4,27,28,2
70,24,60,1.8,,,,,,,7,26,35.4,30,30
70,24,65,1.8,,,,,,,11,26,39.4,32,33
70,24,70,1.8,,,,,,,14,29,45.4,35,36
70,24,75,1.8,,,,,,,17,34,53.4,37,39
70,24,80,1.5,,,,,,1,19,39,61.4,40,41,3
60,27,15,2.4,,,,,,,,2,4.7,10,10
60,27,20,2.4,,,,,,,,5,7.7,13,13
60,27,25,2.1,,,,,,,2,6,10.7,16,16
60,27,30,2.1,,,,,,,3,8,13.7,19,19`;
        },

        loadH2NIA15CSV() {
          return `Nitrox 40% - 2h SI,H2NIA15,40,240,2,12,1.12,18,90,1.5,,,,,,,,1,2.8,109,119,0
Nitrox 40% - 2h SI,H2NIA15,40,240,2,12,1.12,18,100,1.5,,,,,,,,3,4.8,121,133,1
Nitrox 40% - 2h SI,H2NIA15,40,240,2,12,1.12,18,110,1.5,,,,,,,,7,8.8,133,147,0
Nitrox 40% - 2h SI,H2NIA15,40,240,2,12,1.12,18,120,1.5,,,,,,,,11,12.8,145,160,1
Nitrox 40% - 2h SI,H2NIA15,40,240,2,12,1.12,18,130,1.5,,,,,,,,15,16.8,158,174,0
Nitrox 40% - 2h SI,H2NIA15,40,240,2,12,1.12,18,140,1.5,,,,,,,,19,20.8,170,188,1
Nitrox 40% - 2h SI,H2NIA15,40,240,2,12,1.12,18,150,1.5,,,,,,,,23,24.8,182,202,3
Nitrox 40% - 2h SI,H2NIA15,40,180,2,14.4,1.24,21,60,1.8,,,,,,,,1,3.1,85,102,0
Nitrox 40% - 2h SI,H2NIA15,40,180,2,14.4,1.24,21,70,1.8,,,,,,,,5,7.1,99,119,1
Nitrox 40% - 2h SI,H2NIA15,40,180,2,14.4,1.24,21,80,1.8,,,,,,,,10,12.1,113,136,0
Nitrox 40% - 2h SI,H2NIA15,40,180,2,14.4,1.24,21,90,1.8,,,,,,,,16,18.1,127,154,1
Nitrox 40% - 2h SI,H2NIA15,40,180,2,14.4,1.24,21,100,1.8,,,,,,,,24,26.1,142,172,0
Nitrox 40% - 2h SI,H2NIA15,40,180,2,14.4,1.24,21,110,1.8,,,,,,,,32,34.1,156,190,1
Nitrox 40% - 2h SI,H2NIA15,40,180,2,14.4,1.24,21,120,1.8,,,,,,,,39,41.1,170,208,0
Nitrox 40% - 2h SI,H2NIA15,40,180,2,14.4,1.24,21,130,1.8,,,,,,,,47,49.1,185,227,1
Nitrox 40% - 2h SI,H2NIA15,40,180,2,14.4,1.24,21,140,1.8,,,,,,,,54,56.1,199,244,0
Nitrox 40% - 2h SI,H2NIA15,40,180,2,14.4,1.24,21,150,1.8,,,,,,,,60,62.1,213,262,3
Nitrox 40% - 2h SI,H2NIA15,40,120,2,16.7,1.36,24,40,2.1,,,,,,,,1,3.4,65,86,0
Nitrox 40% - 2h SI,H2NIA15,40,120,2,16.7,1.36,24,50,2.1,,,,,,,,4,6.4,81,107,1
Nitrox 40% - 2h SI,H2NIA15,40,120,2,16.7,1.36,24,60,2.1,,,,,,,,9,11.4,97,128,0
Nitrox 40% - 2h SI,H2NIA15,40,120,2,16.7,1.36,24,70,2.1,,,,,,,,19,21.4,113,150,1
Nitrox 40% - 2h SI,H2NIA15,40,120,2,16.7,1.36,24,80,2.1,,,,,,,,30,32.4,130,173,0
Nitrox 40% - 2h SI,H2NIA15,40,120,2,16.7,1.36,24,90,2.1,,,,,,,,40,42.4,146,195,1
Nitrox 40% - 2h SI,H2NIA15,40,120,2,16.7,1.36,24,100,1.8,,,,,,,1,50,53.4,163,218,0
Nitrox 40% - 2h SI,H2NIA15,40,120,2,16.7,1.36,24,110,1.8,,,,,,,3,58,63.4,180,240,1
Nitrox 40% - 2h SI,H2NIA15,40,120,2,16.7,1.36,24,120,1.8,,,,,,,5,66,73.4,197,263,3
Nitrox 40% - 2h SI,H2NIA15,40,90,2,19.1,1.48,27,30,2.4,,,,,,,,1,3.7,55,80,0
Nitrox 40% - 2h SI,H2NIA15,40,90,2,19.1,1.48,27,40,2.4,,,,,,,,4,6.7,73,105,1
Nitrox 40% - 2h SI,H2NIA15,40,90,2,19.1,1.48,27,50,2.4,,,,,,,,11,13.7,91,131,0
Nitrox 40% - 2h SI,H2NIA15,40,90,2,19.1,1.48,27,60,2.4,,,,,,,,25,27.7,109,159,1
Nitrox 40% - 2h SI,H2NIA15,40,90,2,19.1,1.48,27,70,2.1,,,,,,,1,38,41.7,128,186,0
Nitrox 40% - 2h SI,H2NIA15,40,90,2,19.1,1.48,27,80,2.1,,,,,,,4,48,54.7,147,214,1
Nitrox 40% - 2h SI,H2NIA15,40,90,2,19.1,1.48,27,90,2.1,,,,,,,7,59,68.7,167,242,3`;
        },

        parseCSV(csv) {
          const lines = csv.trim().split("\n");
          const rows = [];
          for (let i = 1; i < lines.length; i++) {
            const parts = lines[i].split(",");
            rows.push({
              depth: parseInt(parts[1]),
              time: parseInt(parts[2]),
              till1st: parts[3],
              d24: parts[4] || "—",
              d21: parts[5] || "—",
              d18: parts[6] || "—",
              d15: parts[7] || "—",
              d12: parts[8] || "—",
              d9: parts[9] || "—",
              d6: parts[10] || "—",
              d3: parts[11] || "—",
              deco: parts[12],
              otu: parts[13] || "—",
              esot: parts[14] || "—",
              marker: parseInt(parts[15]) || 0,
            });
          }
          return rows;
        },

        renderLevel1() {
          let html = '<div class="grid">';
          this.tablesData.forEach((cat, i) => {
            html += `<div class="card" onclick="app.selectL1(${i})">
                        <div class="tag ${cat.tagClass}">${cat.tag}</div>
                        <h3>${cat.name}</h3>
                        <p>${cat.children.length} table${cat.children.length !== 1 ? "s" : ""}</p>
                    </div>`;
          });
          document.getElementById("content").innerHTML = html + "</div>";
        },

        renderLevel2(l1) {
          const cat = this.tablesData[l1];
          let html = `<button class="back-btn" onclick="app.renderLevel1()">← Back</button><div class="grid">`;
          cat.children.forEach((t, i) => {
            html += `<div class="card" onclick="app.selectL2(${l1}, ${i})">
                        <div class="tag ${cat.tagClass}">${cat.tag}</div>
                        <h3>${t.name}</h3>
                        <p>${t.code}</p>
                        <p style="font-size:12px; color:#9ca3af;">${t.depths.length} depths</p>
                    </div>`;
          });
          document.getElementById("content").innerHTML = html + "</div></div>";
        },

        renderLevel3(l1, l2) {
          const t = this.tablesData[l1].children[l2];
          let html = `<button class="back-btn" onclick="app.renderLevel2(${l1})">← Back</button>`;
          html += `<div class="section"><h2>${t.name}</h2><p>Code: ${t.code}</p></div>`;
          html += '<div class="depths-grid">';
          t.depths.forEach((d) => {
            html += `<button class="depth-btn" onclick="app.renderTable(${l1}, ${l2}, ${d})">${d}m</button>`;
          });
          document.getElementById("content").innerHTML = html + "</div>";
        },

        renderTable(l1, l2, depth) {
          const cat = this.tablesData[l1];
          const t = cat.children[l2];
          const csv = this.csvData[t.code];
          if (!csv) {
            let html = `<button class="back-btn" onclick="app.renderLevel3(${l1}, ${l2})">← Back</button>`;
            html += `<p style="background:white; padding:20px; border-radius:8px;">No data for ${t.code}</p>`;
            document.getElementById("content").innerHTML = html;
            return;
          }

          const allRows = this.parseCSV(csv);
          const rows = allRows.filter((r) => r.depth === depth);

          let html = `<button class="back-btn" onclick="app.renderLevel3(${l1}, ${l2})">← Back</button>`;
          html += `<div class="table-wrapper"><div class="table-header"><h2>${t.name} - ${depth}m</h2><p>${rows.length} dive schedules</p></div>`;
          html +=
            '<div class="table-scroll"><table><thead><tr><th>Dive Time<br>(min)</th><th>Till 1st<br>Stop</th><th colspan="8">Stop Depth (metres)</th><th>Tot. Deco</th><th>Tot. OTU</th><th>Tot. ESOT</th></tr>';
          html +=
            "<tr><th></th><th></th><th>24m</th><th>21m</th><th>18m</th><th>15m</th><th>12m</th><th>9m</th><th>6m</th><th>3m</th><th></th><th></th><th></th></tr></thead><tbody>";

          rows.forEach((row, idx) => {
            const isLast = idx === rows.length - 1;
            let rowClass = isLast
              ? "row-red"
              : idx % 2 === 0
                ? "row-white"
                : "row-green";
            if (row.marker === 2) rowClass += " marker-2";

            html += `<tr class="${rowClass}"><td><strong>${row.time}</strong></td><td>${row.till1st}</td>`;
            html += `<td>${row.d24}</td><td>${row.d21}</td><td>${row.d18}</td><td>${row.d15}</td>`;
            html += `<td>${row.d12}</td><td>${row.d9}</td><td>${row.d6}</td><td>${row.d3}</td>`;
            html += `<td>${row.deco}</td><td>${row.otu}</td><td>${row.esot}</td></tr>`;
          });

          html += "</tbody></table></div></div>";
          document.getElementById("content").innerHTML = html;
        },

        selectL1(i) {
          this.renderLevel2(i);
        },
        selectL2(l1, l2) {
          this.renderLevel3(l1, l2);
        },
      };

      window.addEventListener("load", () => app.init());
    </script>
  </body>
</html>
