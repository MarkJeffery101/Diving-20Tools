<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dive Tables - Complete Standalone</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #f0f4f8 0%, #fff 50%, #f0f4f8 100%);
            color: #333;
            padding: 20px;
        }
        .container { max-width: 1400px; margin: 0 auto; }
        header {
            background: linear-gradient(135deg, #1f2937 0%, #374151 100%);
            color: white;
            padding: 30px;
            border-radius: 12px;
            margin-bottom: 30px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        header h1 { font-size: 32px; margin-bottom: 8px; }
        header p { font-size: 14px; opacity: 0.9; }
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 16px; margin-bottom: 20px; }
        .card {
            background: white;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }
        .card:hover { border-color: #3b82f6; box-shadow: 0 8px 16px rgba(0,0,0,0.1); }
        .card h3 { font-size: 16px; font-weight: 600; color: #1f2937; margin-bottom: 8px; }
        .card p { font-size: 13px; color: #6b7280; margin-bottom: 8px; }
        .tag {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 6px;
            font-size: 11px;
            font-weight: 700;
            margin-bottom: 12px;
        }
        .tag-blue { background: #dbeafe; color: #1e40af; }
        .tag-cyan { background: #cffafe; color: #0e7490; }
        .tag-orange { background: #fed7aa; color: #92400e; }
        .tag-yellow { background: #fef08a; color: #854d0e; }
        .tag-green { background: #dcfce7; color: #166534; }
        .tag-purple { background: #e9d5ff; color: #6b21a8; }
        .tag-indigo { background: #e0e7ff; color: #312e81; }
        .tag-red { background: #fee2e2; color: #991b1b; }
        .back-btn {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            margin-bottom: 20px;
            font-weight: 600;
            transition: all 0.2s;
        }
        .back-btn:hover { background: #2563eb; }
        .section {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid #e5e7eb;
        }
        .section h2 { font-size: 18px; font-weight: 600; color: #1f2937; margin-bottom: 8px; }
        .section p { font-size: 13px; color: #6b7280; }
        .depths-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(80px, 1fr)); gap: 12px; margin-top: 20px; }
        .depth-btn {
            padding: 12px 10px;
            border: 2px solid #3b82f6;
            background: white;
            color: #3b82f6;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            font-size: 14px;
            transition: all 0.2s;
        }
        .depth-btn:hover { background: #eff6ff; }
        .table-wrapper {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .table-header {
            background: linear-gradient(to bottom, #1d4ed8, #1e40af);
            color: white;
            padding: 20px;
        }
        .table-header h2 { font-size: 18px; font-weight: 600; margin-bottom: 4px; }
        .table-header small { color: #bbb; font-size: 12px; margin-top: 8px; display: block; }
        .table-scroll {
            overflow-x: auto;
            max-height: 700px;
            overflow-y: auto;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 12px;
        }
        thead {
            background: linear-gradient(to bottom, #1d4ed8, #1e40af);
            color: white;
            position: sticky;
            top: 0;
        }
        th, td {
            padding: 10px 6px;
            text-align: center;
            border: 1px solid #e5e7eb;
            white-space: nowrap;
        }
        th { font-weight: bold; font-size: 11px; }
        tbody tr:nth-child(even) { background: #f9f9f9; }
        tbody tr:hover { background: #eff6ff; }
        .error {
            background: #fee2e2;
            color: #991b1b;
            padding: 16px;
            border-radius: 6px;
            margin: 20px 0;
        }
        .loading {
            text-align: center;
            padding: 40px 20px;
            color: #6b7280;
        }
        footer {
            text-align: center;
            padding: 30px 20px;
            color: #999;
            font-size: 12px;
            margin-top: 40px;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üìö Dive Tables Browser</h1>
            <p>Complete decompression tables reference - All data embedded for offline use</p>
        </header>
        <div id="content"></div>
        <footer>Dive Tables Widget v1.0 | All data embedded | Fully functional standalone</footer>
    </div>

    <script>
const TABLES_DATA = {
    'ND15': `Max Depth (metres),Repeat Interval 8 Hours (min),Repeat Interval 2 Hours (min)
9,300,300
12,115,105
15,60,60
18,30,30
21,20,20
24,13,13
27,10,10
30,7,7
33,6,6
36,5,5
39,,`,
    'LND15': `Max Depth (metres),Normal ND15 (min),Long LND15 (min)
9,300,300
10,115,245
11,115,185
12,115,150
13,60,125
14,60,100
15,60,80
18,30,50
21,20,30
24,13,25
27,10,20
30,7,20
33,6,15
36,5,10
39,,10
42,,9
45,,9
48,,7
51,,6`
};

const tableGroups = [
    {
        name: "No-Stop Limits for Air Diving",
        tag: "tag-blue",
        tables: [
            { name: "Air diving, no-stop limits", code: "ND15", isReference: true },
            { name: "No-Stop Limits Extended", code: "LND15", isReference: true }
        ]
    },
    {
        name: "Standard Air Tables",
        tag: "tag-cyan",
        tables: [
            { name: "SIL15 - 12 Hours", code: "SIL15", depths: [12, 15, 18, 21, 24, 27, 30, 33, 36, 39, 42, 45, 48, 51] },
            { name: "SIL15 - 2 Hours", code: "H2SIL15", depths: [12, 15, 18, 21, 24, 27, 30, 33, 36, 39, 42, 45, 48, 51] },
            { name: "SIL15 - 4 Hours", code: "H4SIL15", depths: [12, 15, 18, 21, 24, 27, 30, 33, 36, 39, 42, 45, 48, 51] }
        ]
    },
    {
        name: "Surface/Oxygen Tables",
        tag: "tag-orange",
        tables: [
            { name: "SOX15 - 12 Hours", code: "SOX15", depths: [12, 15, 18, 21, 24, 27, 30, 33, 36, 39, 42, 45, 48, 51] },
            { name: "SOX15 - 4 Hours", code: "HSOX15", depths: [12, 15, 18, 21, 24, 27, 30, 33, 36, 39, 42, 45, 48, 51] }
        ]
    },
    {
        name: "Backup Air Tables",
        tag: "tag-yellow",
        tables: [
            { name: "SAB15 - 12 Hours", code: "SAB15", depths: [12, 15, 18, 21, 24, 27, 30, 33, 36, 39, 42, 45, 48, 51] },
            { name: "SAB15 - 4 Hours", code: "HSAB15", depths: [12, 15, 18, 21, 24, 27, 30, 33, 36, 39, 42, 45, 48, 51] }
        ]
    },
    {
        name: "OTU & ESOT Tables",
        tag: "tag-purple",
        tables: [
            { name: "SOX15 - Surface OX Repetitive Times", code: "SOX15_OTU", depths: [12, 15, 18, 21, 24, 27, 30, 33, 36, 39, 42, 45, 48, 51] },
            { name: "NIA15 - Nitrox 40/60 Repetitive Times", code: "NIA15_OTU", depths: [18, 21, 24, 27] },
            { name: "NIB15 - Nitrox 35/65 Repetitive Times", code: "NIB15_OTU", depths: [18, 21, 24, 27, 30, 33] },
            { name: "BOX15 - Bell Air/Oxygen Repetitive Times", code: "BOX15_OTU", depths: [12, 15, 18, 21, 24, 27, 30, 33, 36, 39, 42, 45, 48, 51] }
        ]
    },
    {
        name: "Nitrox Decompression Tables",
        tag: "tag-green",
        tables: [
            { name: "NIA15 - 40/60 12h", code: "NIA15", depths: [18, 21, 24, 27] },
            { name: "NIA15 - 40/60 2h (2-3)", code: "NIA2_3", depths: [21, 23, 25, 27] },
            { name: "NIA15 - 40/60 2h (2-6)", code: "NIA2_6", depths: [21, 23, 25, 27] },
            { name: "NIA15 - 40/60 2h", code: "H2NIA15", depths: [18, 21, 24, 27] },
            { name: "NIA15 - 40/60 4h", code: "H4NIA15", depths: [18, 21, 24, 27] },
            { name: "NIB15 - 35/65 12h", code: "NIB15", depths: [18, 21, 24, 27, 30, 33] },
            { name: "NIB15 - 35/65 2h", code: "H2NIB15", depths: [18, 21, 24, 27, 30, 33] },
            { name: "NIB15 - 35/65 4h", code: "H4NIB15", depths: [18, 21, 24, 27, 30, 33] }
        ]
    },
    {
        name: "Wet or Dry Bell Air/Oxygen Tables",
        tag: "tag-indigo",
        tables: [
            { name: "BOX15 - Bell diving", code: "BOX15", depths: [12, 15, 18, 21, 24, 27, 30, 33, 36, 39, 42, 45, 48, 51] }
        ]
    },
    {
        name: "Treatment Tables DCS & AGE",
        tag: "tag-red",
        tables: [
            { name: "COMEX Table CX 12", code: "CX12", isReference: true },
            { name: "COMEX Table CX 30", code: "CX30", isReference: true },
            { name: "US Navy Oxygen Treatment Table 5", code: "USN-T5", isReference: true },
            { name: "US Navy Oxygen Treatment Table 6", code: "USN-T6", isReference: true },
            { name: "Air Treatment Table 1A", code: "AIR-T1A", isReference: true },
            { name: "Air Treatment Table 2A", code: "AIR-T2A", isReference: true },
            { name: "Air Treatment Table 3", code: "AIR-T3", isReference: true },
            { name: "Air Treatment Table 4", code: "AIR-T4", isReference: true }
        ]
    }
];

function parseCSV(text) {
    const rows = [];
    let row = [];
    let field = '';
    let inQuotes = false;
    
    for (let i = 0; i < text.length; i++) {
        const c = text[i];
        const n = text[i + 1];
        if (inQuotes) {
            if (c === '"' && n === '"') {
                field += '"';
                i++;
            } else if (c === '"') {
                inQuotes = false;
            } else {
                field += c;
            }
        } else {
            if (c === '"') {
                inQuotes = true;
            } else if (c === ',') {
                row.push(field.trim());
                field = '';
            } else if (c === '\n' || c === '\r') {
                if (c === '\r' && n === '\n') i++;
                row.push(field.trim());
                if (row.some(v => v)) rows.push(row);
                row = [];
                field = '';
            } else {
                field += c;
            }
        }
    }
    if (field || row.length) {
        row.push(field.trim());
        if (row.some(v => v)) rows.push(row);
    }
    return rows;
}

function loadTableData(code) {
    if (TABLES_DATA[code]) {
        const rows = parseCSV(TABLES_DATA[code]);
        if (rows.length > 0) {
            return { headers: rows[0], rows: rows.slice(1) };
        }
    }
    return null;
}

function getEmbeddedTables() {
    return Object.keys(TABLES_DATA);
}

function renderReferenceTable(gIdx, tIdx) {
    const g = tableGroups[gIdx];
    const t = g.tables[tIdx];
    const data = loadTableData(t.code);
    
    let html = `<button class="back-btn" onclick="app.renderLevel2(${gIdx})">‚Üê Back</button>`;
    
    if (!data) {
        html += `<div class="error">No data available for ${t.code}. This table requires the project data files.</div>`;
        document.getElementById('content').innerHTML = html;
        return;
    }
    
    html += `<div class="table-wrapper"><div class="table-header"><h2>${t.name}</h2><small>Reference table - No-stop limits</small></div>`;
    html += '<div class="table-scroll"><table><thead><tr>';
    
    data.headers.forEach(h => {
        html += `<th>${h}</th>`;
    });
    
    html += '</tr></thead><tbody>';
    data.rows.forEach((row, idx) => {
        html += `<tr>`;
        row.forEach((cell, cidx) => {
            html += `<td>${cell || '‚Äî'}</td>`;
        });
        html += '</tr>';
    });
    
    html += '</tbody></table></div></div>';
    document.getElementById('content').innerHTML = html;
}

function renderDepthTable(gIdx, tIdx, depth) {
    const g = tableGroups[gIdx];
    const t = g.tables[tIdx];
    const embeddedTables = getEmbeddedTables();
    const dataAvailable = embeddedTables.includes(t.code);

    let html = `<button class="back-btn" onclick="app.renderLevel3(${gIdx}, ${tIdx})">‚Üê Back</button>`;
    document.getElementById('content').innerHTML = html + '<div class="loading">Loading table data...</div>';

    html = `<button class="back-btn" onclick="app.renderLevel3(${gIdx}, ${tIdx})">‚Üê Back</button>`;
    html += `<div class="section"><h2>${t.name} - ${depth}m</h2><p>Decompression table at ${depth} metres</p></div>`;

    if (!dataAvailable) {
        html += `<div class="error"><strong>Data Not Embedded</strong><br/>The ${t.code} table data is not embedded in this standalone widget. To use full table data, access the application through the web interface or add CSV data to the widget file.</div>`;
        document.getElementById('content').innerHTML = html;
        return;
    }

    // If data is available, load and display it
    const data = loadTableData(t.code);
    if (!data || !data.rows || data.rows.length === 0) {
        html += `<div class="error">No data available for ${t.code} at ${depth}m depth.</div>`;
        document.getElementById('content').innerHTML = html;
        return;
    }

    // Filter rows for the specific depth
    const filteredRows = data.rows.filter(row => {
        const rowDepth = row[1]; // Assuming depth is in column 2
        return rowDepth && parseInt(rowDepth) === depth;
    });

    if (filteredRows.length === 0) {
        html += `<div class="error">No rows found for depth ${depth}m in ${t.code} table.</div>`;
        document.getElementById('content').innerHTML = html;
        return;
    }

    html += `<div class="table-wrapper"><div class="table-header"><h2>${t.name} - ${depth}m</h2><small>Decompression schedule for ${depth} metres</small></div>`;
    html += '<div class="table-scroll"><table><thead><tr>';

    data.headers.forEach(h => {
        html += `<th>${h}</th>`;
    });

    html += '</tr></thead><tbody>';
    filteredRows.forEach((row, idx) => {
        html += `<tr>`;
        row.forEach((cell, cidx) => {
            html += `<td>${cell || '‚Äî'}</td>`;
        });
        html += '</tr>';
    });

    html += '</tbody></table></div></div>';
    document.getElementById('content').innerHTML = html;
}

const app = {
    renderLevel1() {
        let html = '<div class="grid">';
        tableGroups.forEach((g, i) => {
            html += `<div class="card" onclick="app.renderLevel2(${i})" style="cursor: pointer;">
                <div class="tag ${g.tag}">${g.name}</div>
                <h3>${g.name}</h3>
                <p>${g.tables.length} table${g.tables.length !== 1 ? 's' : ''}</p>
            </div>`;
        });
        document.getElementById('content').innerHTML = html + '</div>';
    },
    
    renderLevel2(gIdx) {
        const g = tableGroups[gIdx];
        if (g.tables.length === 1) {
            this.renderLevel3(gIdx, 0);
            return;
        }
        let html = `<button class="back-btn" onclick="app.renderLevel1()">‚Üê Back</button><div class="grid">`;
        g.tables.forEach((t, tIdx) => {
            html += `<div class="card" onclick="app.renderLevel3(${gIdx}, ${tIdx})" style="cursor: pointer;">
                <div class="tag ${g.tag}">${g.name}</div>
                <h3>${t.name}</h3>
                <p>${t.code}</p>
            </div>`;
        });
        document.getElementById('content').innerHTML = html + '</div>';
    },
    
    renderLevel3(gIdx, tIdx) {
        const g = tableGroups[gIdx];
        const t = g.tables[tIdx];
        let html = `<button class="back-btn" onclick="app.renderLevel2(${gIdx})">‚Üê Back</button>`;
        html += `<div class="section"><h2>${t.name}</h2><p>${t.code}</p></div>`;
        
        if (t.isReference) {
            html += `<button class="back-btn" style="background: #059669; margin-left: 0;" onclick="app.renderRefTable(${gIdx}, ${tIdx})">View Table</button>`;
        } else {
            html += '<div class="depths-grid">';
            t.depths.forEach((d) => {
                html += `<button class="depth-btn" onclick="app.renderDepthTable(${gIdx}, ${tIdx}, ${d})">${d}m</button>`;
            });
            html += '</div>';
        }
        document.getElementById('content').innerHTML = html;
    },
    
    renderRefTable(gIdx, tIdx) {
        renderReferenceTable(gIdx, tIdx);
    },
    
    renderDepthTable(gIdx, tIdx, depth) {
        renderDepthTable(gIdx, tIdx, depth);
    }
};

app.renderLevel1();
    </script>
</body>
</html>
