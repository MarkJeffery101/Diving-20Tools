<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Complete Dive Tools - All Calculators</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: #f5f5f5; color: #333; }
        .container { max-width: 1000px; margin: 0 auto; padding: 20px; }
        header { background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%); color: white; padding: 30px; border-radius: 8px; margin-bottom: 30px; }
        header h1 { font-size: 32px; margin-bottom: 5px; }
        header p { font-size: 14px; opacity: 0.9; }
        .tabs { display: flex; gap: 5px; margin-bottom: 20px; flex-wrap: wrap; border-bottom: 3px solid #ddd; }
        .tab-btn { padding: 12px 20px; border: none; background: #f0f0f0; color: #333; cursor: pointer; font-weight: 600; border-radius: 4px 4px 0 0; transition: all 0.2s; }
        .tab-btn:hover { background: #e0e0e0; }
        .tab-btn.active { background: #16213e; color: white; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .card { background: white; border: 2px solid #ddd; border-radius: 8px; padding: 25px; margin-bottom: 20px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .card h2 { color: #1a1a2e; margin-bottom: 20px; border-bottom: 2px solid #16213e; padding-bottom: 10px; }
        .card h3 { color: #16213e; margin-top: 20px; margin-bottom: 15px; }
        .input-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; font-weight: 600; color: #1a1a2e; }
        input, select { width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 4px; font-size: 14px; }
        input:focus, select:focus { outline: none; border-color: #16213e; }
        small { display: block; color: #666; font-size: 12px; margin-top: 3px; }
        .row { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .row-3 { display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; }
        .buttons { display: flex; gap: 10px; margin-top: 20px; }
        button { padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer; font-weight: bold; transition: all 0.2s; }
        .btn-primary { background: #16213e; color: white; }
        .btn-primary:hover { background: #0f1419; }
        .btn-secondary { background: #ddd; color: #333; }
        .btn-secondary:hover { background: #ccc; }
        .results { background: #e8f4f8; border: 2px solid #16213e; border-radius: 8px; padding: 20px; margin-top: 20px; }
        .results h3 { color: #16213e; margin-bottom: 15px; }
        .result-item { display: flex; justify-content: space-between; padding: 12px 0; border-bottom: 1px solid #bbb; }
        .result-item:last-child { border-bottom: none; }
        .result-item span:last-child { font-weight: bold; color: #16213e; }
        .alert { background: #ffe8e8; border-left: 4px solid #cc0000; padding: 15px; margin-bottom: 20px; border-radius: 4px; font-size: 13px; color: #660000; }
        .info { background: #fffbea; border-left: 4px solid #ff9800; padding: 15px; margin-bottom: 20px; border-radius: 4px; font-size: 13px; }
        .rows-container { max-height: 400px; overflow-y: auto; border: 2px solid #ddd; border-radius: 4px; padding: 15px; background: #f9f9f9; }
        .row-item { background: white; padding: 12px; margin-bottom: 10px; border: 1px solid #ddd; border-radius: 4px; display: grid; grid-template-columns: 1fr 1fr 1fr auto; gap: 10px; align-items: end; }
        .remove-btn { background: #cc3333; color: white; padding: 8px 12px; border: none; border-radius: 4px; cursor: pointer; }
        .remove-btn:hover { background: #aa2222; }
        footer { text-align: center; padding: 20px; color: #666; font-size: 12px; margin-top: 30px; }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üõ†Ô∏è Complete Dive Tools</h1>
            <p>All diving calculation tools in one standalone widget</p>
        </header>
        
        <div class="tabs">
            <button class="tab-btn active" onclick="switchTab('ead')">EAD Calculator</button>
            <button class="tab-btn" onclick="switchTab('bailout')">Bail Out</button>
            <button class="tab-btn" onclick="switchTab('nitrox')">Nitrox Failure</button>
            <button class="tab-btn" onclick="switchTab('otu')">OTU/ESOT</button>
            <button class="tab-btn" onclick="switchTab('residual')">Residual ESOT</button>
        </div>

        <div id="ead" class="tab-content active">
            <div class="card">
                <h2>üåä Equivalent Air Depth (EAD)</h2>
                <div class="info">
                    <p><strong>EAD:</strong> The equivalent depth at which air would have the same nitrogen partial pressure as your nitrox mix at actual depth. Formula: EAD = (Depth + 10) √ó ((1 - O‚ÇÇ%) / 0.79) - 10</p>
                </div>
                <div class="row">
                    <div class="input-group">
                        <label>Actual Depth (m)</label>
                        <input type="number" id="ead-depth" value="30" placeholder="30">
                    </div>
                    <div class="input-group">
                        <label>O‚ÇÇ Percentage (%)</label>
                        <input type="number" id="ead-o2" value="32" min="21" max="100" placeholder="32">
                    </div>
                </div>
                <div class="buttons">
                    <button class="btn-primary" onclick="eadCalc.calculate()">Calculate EAD</button>
                    <button class="btn-secondary" onclick="eadCalc.reset()">Reset</button>
                </div>
            </div>
            <div id="ead-results" class="card results" style="display:none;">
                <h3>EAD Results</h3>
                <div class="result-item">
                    <span>Equivalent Air Depth (EAD):</span>
                    <span id="ead-result">0m</span>
                </div>
                <div class="result-item">
                    <span>pO‚ÇÇ at Depth:</span>
                    <span id="ead-po2">0 bar/abs</span>
                </div>
                <div class="result-item">
                    <span>Status:</span>
                    <span id="ead-status">Safe</span>
                </div>
                <div class="result-item">
                    <span>Use Air Table for Depth:</span>
                    <span id="ead-table">‚Äîm</span>
                </div>
            </div>
        </div>

        <div id="bailout" class="tab-content">
            <div class="card">
                <h2>ü™£ Bail Out - Backup Gas Calculator</h2>
                <div class="info">
                    <p><strong>Bail Out Calculation:</strong> Determines backup gas requirements for emergency ascent. Calculates effective nitrogen percentage and gas consumption rates.</p>
                </div>
                <h3>Dive Parameters</h3>
                <div class="row-3">
                    <div class="input-group">
                        <label>Depth (m)</label>
                        <input type="number" id="bailout-depth" value="40" placeholder="40">
                    </div>
                    <div class="input-group">
                        <label>Dive Time (min)</label>
                        <input type="number" id="bailout-time" value="30" placeholder="30">
                    </div>
                    <div class="input-group">
                        <label>Primary O‚ÇÇ (%)</label>
                        <input type="number" id="bailout-o2" value="32" placeholder="32">
                    </div>
                </div>
                <h3>Backup Gas Supply</h3>
                <div class="row-3">
                    <div class="input-group">
                        <label>Starting Pressure (bar)</label>
                        <input type="number" id="bailout-start" value="230" placeholder="230">
                    </div>
                    <div class="input-group">
                        <label>Ending Reserve (bar)</label>
                        <input type="number" id="bailout-end" value="50" placeholder="50">
                    </div>
                    <div class="input-group">
                        <label>Cylinder Volume (L)</label>
                        <input type="number" id="bailout-vol" value="10" placeholder="10">
                    </div>
                </div>
                <div class="buttons">
                    <button class="btn-primary" onclick="bailoutCalc.calculate()">Calculate Bail Out</button>
                    <button class="btn-secondary" onclick="bailoutCalc.reset()">Reset</button>
                </div>
            </div>
            <div id="bailout-results" class="card results" style="display:none;">
                <h3>Bail Out Analysis</h3>
                <div class="result-item">
                    <span>Available Gas Volume:</span>
                    <span id="bailout-gas">0 L</span>
                </div>
                <div class="result-item">
                    <span>Effective O‚ÇÇ:</span>
                    <span id="bailout-eff-o2">0%</span>
                </div>
                <div class="result-item">
                    <span>EAD (Backup Gas):</span>
                    <span id="bailout-ead">0m</span>
                </div>
                <div class="result-item">
                    <span>pO‚ÇÇ at Depth:</span>
                    <span id="bailout-po2">0 bar/abs</span>
                </div>
                <div class="result-item">
                    <span>Status:</span>
                    <span id="bailout-status">Safe</span>
                </div>
            </div>
        </div>

        <div id="nitrox" class="tab-content">
            <div class="card">
                <h2>‚ö†Ô∏è Nitrox Failure - Emergency Gas Switch</h2>
                <div class="alert">
                    <p><strong>EMERGENCY SCENARIO:</strong> Diver is on Nitrox and must switch to emergency air supply mid-dive. This calculates the new EAD and effective nitrogen loading for decompression.</p>
                </div>
                <h3>Nitrox Dive Parameters</h3>
                <div class="row-3">
                    <div class="input-group">
                        <label>Depth (m)</label>
                        <input type="number" id="nitrox-depth" value="30" placeholder="30">
                    </div>
                    <div class="input-group">
                        <label>Time on Nitrox (min)</label>
                        <input type="number" id="nitrox-time" value="20" placeholder="20">
                    </div>
                    <div class="input-group">
                        <label>Nitrox O‚ÇÇ (%)</label>
                        <input type="number" id="nitrox-o2" value="32" placeholder="32">
                    </div>
                </div>
                <div class="input-group">
                    <label>Time on Air (remaining bottom time, min)</label>
                    <input type="number" id="nitrox-air-time" value="10" placeholder="10">
                </div>
                <div class="buttons">
                    <button class="btn-primary" onclick="nitroxCalc.calculate()">Calculate Emergency Response</button>
                    <button class="btn-secondary" onclick="nitroxCalc.reset()">Reset</button>
                </div>
            </div>
            <div id="nitrox-results" class="card results" style="display:none;">
                <h3>Emergency Gas Switch Results</h3>
                <div class="result-item">
                    <span>Effective O‚ÇÇ (weighted):</span>
                    <span id="nitrox-eff-o2">0%</span>
                </div>
                <div class="result-item">
                    <span>New EAD:</span>
                    <span id="nitrox-ead">0m</span>
                </div>
                <div class="result-item">
                    <span>Effective N‚ÇÇ Loading:</span>
                    <span id="nitrox-n2">0%</span>
                </div>
                <div class="result-item">
                    <span>Decompression Requirement:</span>
                    <span id="nitrox-deco">‚Äî</span>
                </div>
            </div>
        </div>

        <div id="otu" class="tab-content">
            <div class="card">
                <h2>üßÆ OTU & ESOT Calculator</h2>
                <div class="info">
                    <p><strong>OTU (Oxygen Toxicity Units):</strong> Cumulative measure of oxygen toxicity based on depth and time. IMCA limit is 1500 OTU per 24hrs.</p>
                    <p><strong>ESOT (Exposure Surface Oxygen Time):</strong> Equivalent surface oxygen exposure time.</p>
                </div>
                <div class="buttons" style="margin-bottom: 15px;">
                    <button class="btn-primary" onclick="otuCalc.addRow()">+ Add Segment</button>
                </div>
                <div class="rows-container" id="otu-rows"></div>
                <div class="buttons">
                    <button class="btn-primary" onclick="otuCalc.calculate()">Calculate OTU & ESOT</button>
                    <button class="btn-secondary" onclick="otuCalc.reset()">Reset</button>
                </div>
            </div>
            <div id="otu-results" class="card results" style="display:none;">
                <h3>Results</h3>
                <div class="result-item">
                    <span>Total OTU:</span>
                    <span id="otu-total">0</span>
                </div>
                <div class="result-item">
                    <span>Total ESOT:</span>
                    <span id="otu-esot">0</span>
                </div>
                <div class="result-item">
                    <span>OTU Status:</span>
                    <span id="otu-status">Safe</span>
                </div>
            </div>
        </div>

        <div id="residual" class="tab-content">
            <div class="card">
                <h2>‚è±Ô∏è Residual ESOT Calculator</h2>
                <div class="info">
                    <p><strong>Residual ESOT:</strong> Oxygen exposure carryover from previous dive to next dive. Used to calculate decompression requirements for repetitive hyperoxic exposures.</p>
                </div>
                <h3>Previous Dive Data</h3>
                <div class="row">
                    <div class="input-group">
                        <label>Previous ESOT</label>
                        <input type="number" id="residual-esot" value="200" placeholder="200">
                    </div>
                    <div class="input-group">
                        <label>Previous pO‚ÇÇ</label>
                        <input type="number" id="residual-po2" value="1.4" step="0.01" placeholder="1.4">
                    </div>
                </div>
                <div class="input-group">
                    <label>Surface Interval (hours)</label>
                    <input type="number" id="residual-si" value="10" placeholder="10">
                </div>
                <div class="buttons">
                    <button class="btn-primary" onclick="residualCalc.calculate()">Calculate Residual</button>
                    <button class="btn-secondary" onclick="residualCalc.reset()">Reset</button>
                </div>
            </div>
            <div id="residual-results" class="card results" style="display:none;">
                <h3>Residual ESOT Results</h3>
                <div class="result-item">
                    <span>Residual ESOT:</span>
                    <span id="residual-result">0</span>
                </div>
                <div class="result-item">
                    <span>% of Previous:</span>
                    <span id="residual-percent">0%</span>
                </div>
                <div class="result-item">
                    <span>Decay Factor:</span>
                    <span id="residual-decay">0</span>
                </div>
            </div>
        </div>

        <footer>Complete Dive Tools Widget v1.0 | All calculators fully functional offline</footer>
    </div>

    <script>
        function switchTab(tabName) {
            const tabs = document.querySelectorAll('.tab-content');
            const btns = document.querySelectorAll('.tab-btn');
            tabs.forEach(t => t.classList.remove('active'));
            btns.forEach(b => b.classList.remove('active'));
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
        }

        const eadCalc = {
            calculate() {
                const depth = parseFloat(document.getElementById('ead-depth').value) || 0;
                const o2 = parseFloat(document.getElementById('ead-o2').value) || 21;
                
                if (depth < 0 || o2 < 21 || o2 > 100) {
                    alert('Invalid input');
                    return;
                }
                
                const fractionN2 = (100 - o2) / 100;
                const ead = (depth + 10) * (fractionN2 / 0.79) - 10;
                const po2 = (o2 / 100) * (depth / 10 + 1);
                
                let status = 'Safe';
                if (po2 > 1.6) status = 'DANGER - pO2 exceeds 1.6 bar';
                else if (po2 > 1.4) status = 'CAUTION - High pO2';
                
                const tableDepths = [9, 12, 15, 18, 21, 24, 27, 30, 33, 36, 39, 42, 45, 48, 51];
                let tableDepth = 51;
                for (let d of tableDepths) {
                    if (ead <= d) {
                        tableDepth = d;
                        break;
                    }
                }
                
                document.getElementById('ead-result').textContent = ead.toFixed(1) + 'm';
                document.getElementById('ead-po2').textContent = po2.toFixed(2) + ' bar/abs';
                document.getElementById('ead-status').textContent = status;
                document.getElementById('ead-table').textContent = tableDepth + 'm';
                document.getElementById('ead-results').style.display = 'block';
            },
            reset() {
                document.getElementById('ead-depth').value = '30';
                document.getElementById('ead-o2').value = '32';
                document.getElementById('ead-results').style.display = 'none';
            }
        };

        const bailoutCalc = {
            calculate() {
                const depth = parseFloat(document.getElementById('bailout-depth').value) || 0;
                const time = parseFloat(document.getElementById('bailout-time').value) || 0;
                const primaryO2 = parseFloat(document.getElementById('bailout-o2').value) || 32;
                const startBar = parseFloat(document.getElementById('bailout-start').value) || 230;
                const endBar = parseFloat(document.getElementById('bailout-end').value) || 50;
                const volume = parseFloat(document.getElementById('bailout-vol').value) || 10;
                
                if (depth < 0 || volume < 0) {
                    alert('Invalid input');
                    return;
                }
                
                const availableBar = startBar - endBar;
                const gasVolume = availableBar * volume;
                const effectiveO2 = (primaryO2 + 21) / 2;
                const fractionN2 = 0.79;
                const ead = (depth + 10) * (fractionN2 / 0.79) - 10;
                const po2 = 0.21 * (depth / 10 + 1);
                
                let status = 'Safe';
                if (po2 > 1.4) status = 'CAUTION - Moderate pO2';
                if (po2 > 1.6) status = 'DANGER - High pO2';
                
                document.getElementById('bailout-gas').textContent = gasVolume.toFixed(0) + ' L';
                document.getElementById('bailout-eff-o2').textContent = effectiveO2.toFixed(1) + '%';
                document.getElementById('bailout-ead').textContent = ead.toFixed(1) + 'm';
                document.getElementById('bailout-po2').textContent = po2.toFixed(2) + ' bar/abs';
                document.getElementById('bailout-status').textContent = status;
                document.getElementById('bailout-results').style.display = 'block';
            },
            reset() {
                document.getElementById('bailout-depth').value = '40';
                document.getElementById('bailout-time').value = '30';
                document.getElementById('bailout-o2').value = '32';
                document.getElementById('bailout-start').value = '230';
                document.getElementById('bailout-end').value = '50';
                document.getElementById('bailout-vol').value = '10';
                document.getElementById('bailout-results').style.display = 'none';
            }
        };

        const nitroxCalc = {
            calculate() {
                const depth = parseFloat(document.getElementById('nitrox-depth').value) || 0;
                const nitroxTime = parseFloat(document.getElementById('nitrox-time').value) || 0;
                const nitroxO2 = parseFloat(document.getElementById('nitrox-o2').value) || 32;
                const airTime = parseFloat(document.getElementById('nitrox-air-time').value) || 0;
                
                const totalTime = nitroxTime + airTime;
                const effectiveO2 = (nitroxO2 * nitroxTime + 21 * airTime) / totalTime;
                
                const fractionN2 = (100 - effectiveO2) / 100;
                const ead = (depth + 10) * (fractionN2 / 0.79) - 10;
                
                const effectiveN2 = (79 * nitroxTime + 79 * airTime) / totalTime;
                const decoStatus = nitroxTime > airTime ? 'ELEVATED nitrogen loading' : 'Moderate nitrogen loading';
                
                document.getElementById('nitrox-eff-o2').textContent = effectiveO2.toFixed(1) + '%';
                document.getElementById('nitrox-ead').textContent = ead.toFixed(1) + 'm';
                document.getElementById('nitrox-n2').textContent = effectiveN2.toFixed(1) + '%';
                document.getElementById('nitrox-deco').textContent = decoStatus;
                document.getElementById('nitrox-results').style.display = 'block';
            },
            reset() {
                document.getElementById('nitrox-depth').value = '30';
                document.getElementById('nitrox-time').value = '20';
                document.getElementById('nitrox-o2').value = '32';
                document.getElementById('nitrox-air-time').value = '10';
                document.getElementById('nitrox-results').style.display = 'none';
            }
        };

        const otuCalc = {
            rows: [],
            addRow() {
                const id = Date.now();
                this.rows.push({ id, depth: '', o2: 21, time: '' });
                this.renderRows();
            },
            renderRows() {
                const container = document.getElementById('otu-rows');
                container.innerHTML = '';
                this.rows.forEach(row => {
                    const div = document.createElement('div');
                    div.className = 'row-item';
                    div.innerHTML = `
                        <input type="number" value="${row.depth}" placeholder="Depth (m)" onchange="otuCalc.updateRow(${row.id}, 'depth', this.value)">
                        <input type="number" value="${row.o2}" placeholder="O‚ÇÇ (%)" min="21" max="100" onchange="otuCalc.updateRow(${row.id}, 'o2', this.value)">
                        <input type="number" value="${row.time}" placeholder="Time (min)" onchange="otuCalc.updateRow(${row.id}, 'time', this.value)">
                        <button class="remove-btn" onclick="otuCalc.removeRow(${row.id})">Remove</button>
                    `;
                    container.appendChild(div);
                });
            },
            updateRow(id, field, value) {
                const row = this.rows.find(r => r.id === id);
                if (row) row[field] = parseFloat(value) || 0;
            },
            removeRow(id) {
                this.rows = this.rows.filter(r => r.id !== id);
                this.renderRows();
            },
            calculate() {
                let totalOtu = 0, totalEsot = 0;
                
                this.rows.forEach(row => {
                    if (row.depth && row.time) {
                        const po2 = (row.o2 / 100) * (row.depth / 10 + 1);
                        if (po2 > 0.5) {
                            totalOtu += Math.max(0, (po2 - 0.5) * row.time);
                            totalEsot += row.time * (po2 - 0.5);
                        }
                    }
                });
                
                let status = 'Safe';
                if (totalOtu > 1500) status = '‚ö†Ô∏è WARNING - Exceeds 1500 OTU limit';
                
                document.getElementById('otu-total').textContent = totalOtu.toFixed(0);
                document.getElementById('otu-esot').textContent = totalEsot.toFixed(1);
                document.getElementById('otu-status').textContent = status;
                document.getElementById('otu-results').style.display = 'block';
            },
            reset() {
                this.rows = [];
                this.renderRows();
                document.getElementById('otu-results').style.display = 'none';
            }
        };

        const residualCalc = {
            calculate() {
                const prevEsot = parseFloat(document.getElementById('residual-esot').value) || 0;
                const prevPo2 = parseFloat(document.getElementById('residual-po2').value) || 0;
                const siHours = parseFloat(document.getElementById('residual-si').value) || 0;
                
                const decayFactor = Math.exp(-siHours / 10);
                const residualEsot = prevEsot * decayFactor;
                const percentPrev = (residualEsot / prevEsot * 100).toFixed(1);
                
                document.getElementById('residual-result').textContent = residualEsot.toFixed(0);
                document.getElementById('residual-percent').textContent = percentPrev + '%';
                document.getElementById('residual-decay').textContent = decayFactor.toFixed(3);
                document.getElementById('residual-results').style.display = 'block';
            },
            reset() {
                document.getElementById('residual-esot').value = '200';
                document.getElementById('residual-po2').value = '1.4';
                document.getElementById('residual-si').value = '10';
                document.getElementById('residual-results').style.display = 'none';
            }
        };

        otuCalc.addRow();
    </script>
</body>
</html>
