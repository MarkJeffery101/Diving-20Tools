<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TUP Calculator - Complete</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: #f5f5f5; color: #333; }
        .container { max-width: 1400px; margin: 0 auto; padding: 20px; }
        header { background: linear-gradient(135deg, #062737 0%, #0d4a66 100%); color: white; padding: 30px; border-radius: 8px; margin-bottom: 30px; }
        header h1 { font-size: 32px; margin-bottom: 5px; }
        header p { font-size: 14px; opacity: 0.9; }
        .layout { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px; }
        .card { background: white; border: 2px solid #ddd; border-radius: 8px; padding: 20px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .card h2 { color: #062737; margin-bottom: 15px; font-size: 18px; border-bottom: 2px solid #0d4a66; padding-bottom: 10px; }
        .input-group { margin-bottom: 12px; }
        label { display: block; margin-bottom: 5px; font-weight: 600; font-size: 13px; color: #1f2937; }
        input { width: 100%; padding: 8px; border: 2px solid #ddd; border-radius: 4px; font-size: 13px; }
        input:focus { outline: none; border-color: #0d4a66; }
        small { display: block; color: #666; font-size: 12px; margin-top: 3px; }
        .output-row { display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px solid #eee; }
        .output-row span:first-child { font-weight: 600; }
        .output-row span:last-child { font-weight: bold; color: #062737; }
        .buttons { display: flex; gap: 10px; margin-top: 15px; }
        button { padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer; font-weight: bold; transition: all 0.2s; }
        .btn-primary { background: #0d4a66; color: white; }
        .btn-primary:hover { background: #062737; }
        .btn-secondary { background: #ddd; color: #333; }
        .btn-secondary:hover { background: #ccc; }
        .table-wrapper { background: white; border: 4px solid #062737; border-radius: 8px; overflow: hidden; }
        .table-header { background: #062737; color: white; padding: 15px; }
        .table-header h2 { margin: 0; color: white; border: none; padding: 0; }
        .table-scroll { overflow-x: auto; padding: 15px; max-height: 600px; overflow-y: auto; }
        table { width: 100%; border-collapse: collapse; font-size: 11px; }
        thead { background: #0d4a66; color: white; position: sticky; top: 0; }
        th, td { padding: 6px; text-align: center; border: 1px solid #ddd; }
        th { font-weight: bold; }
        tbody tr:nth-child(even) { background: #f9f9f9; }
        tbody tr:hover { background: #e8f4f8; }
        .oxy-col { background: #d4e8f0; }
        .highlight { background: #fff9c4; font-weight: bold; }
        .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        @media (max-width: 1200px) { .layout { grid-template-columns: 1fr; } .grid-2 { grid-template-columns: 1fr; } }
        footer { text-align: center; padding: 20px; color: #666; font-size: 12px; margin-top: 30px; }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üèä Transfer Under Pressure (TUP) Calculator</h1>
            <p>Air / Oxygen Decompression Tables for TUP Diving</p>
        </header>
        
        <div class="layout">
            <div class="card" style="background: #e8f5e9; border-color: #4caf50;">
                <h2>üîß Inputs</h2>
                <div class="input-group">
                    <label>Maximum Diving Depth (m/sw)</label>
                    <input type="number" id="maxDepth" value="30" placeholder="30">
                </div>
                <div class="input-group">
                    <label>Nitrox O‚ÇÇ (%)</label>
                    <input type="number" id="o2" value="21" placeholder="21" min="21" max="40">
                    <small>Only 21 and 30-40 allowed</small>
                </div>
                <div class="input-group">
                    <label>Dive Time (min)</label>
                    <input type="number" id="diveTime" value="45" placeholder="45">
                </div>
                <div class="buttons">
                    <button class="btn-primary" onclick="tup.calculate()">Calculate</button>
                    <button class="btn-secondary" onclick="tup.reset()">Reset</button>
                </div>
            </div>
            
            <div class="card" style="background: #f3e5f5; border-color: #9c27b0;">
                <h2>üìä Outputs</h2>
                <div class="output-row">
                    <span>EAD Calculated (m/sw):</span>
                    <span id="ead">‚Äî</span>
                </div>
                <div class="output-row">
                    <span>PO2 at Diving Depth:</span>
                    <span id="po2">‚Äî</span>
                </div>
                <div class="output-row">
                    <span>IMCA TUP Max Bottom Time:</span>
                    <span id="maxBottomTime">‚Äî</span>
                </div>
                <div class="output-row">
                    <span>Table to Use (depth):</span>
                    <span id="tableUse">‚Äî</span>
                </div>
                <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid #bbb;">
                    <p style="font-size: 12px; color: #666;">
                        <strong>Safety Note:</strong> Always follow your training and local diving regulations. 
                        EAD calculations help determine decompression requirements for nitrox diving.
                    </p>
                </div>
            </div>
        </div>
        
        <div class="table-wrapper">
            <div class="table-header">
                <h2 style="margin: 0; color: white;">Decompression Table</h2>
                <small style="color: #ccc; margin-top: 5px; display: block;">Stop times in minutes | Oxygen columns highlighted in blue</small>
            </div>
            <div class="table-scroll">
                <table id="decompressionTable">
                    <thead>
                        <tr>
                            <th>Depth(m/sw)</th>
                            <th>BottomTime(min)</th>
                            <th>Time to 1st Stop(min)</th>
                            <th>24 Air</th>
                            <th>21 Air</th>
                            <th>18 Air</th>
                            <th>15 Air TUP</th>
                            <th class="oxy-col">15 Oxygen</th>
                            <th>12 Air</th>
                            <th class="oxy-col">12 Oxygen</th>
                            <th>9 Air</th>
                            <th class="oxy-col">9 Oxygen</th>
                            <th>6 Air</th>
                            <th class="oxy-col">6 Oxygen</th>
                            <th>3 Air</th>
                            <th class="oxy-col">3 Oxygen</th>
                            <th>Total Deco(min)</th>
                        </tr>
                    </thead>
                    <tbody id="tableBody"></tbody>
                </table>
            </div>
        </div>
        
        <footer>TUP Calculator Widget v1.0 | Complete functional implementation | All data embedded offline</footer>
    </div>

    <script>
        const IMCA_TUP_LIMITS = {
            9: 240, 12: 240, 15: 240, 18: 240, 19: 240, 20: 240, 21: 240, 22: 240,
            23: 180, 24: 180, 25: 180, 26: 180, 27: 180, 28: 180, 29: 180, 30: 180,
            31: 180, 32: 180, 33: 180, 36: 180, 39: 180, 42: 180, 45: 180, 48: 180, 51: 180
        };
        
        const DECOMPRESSION_DATA = {
            30: [
                { time: 30, ascent: 1.9, s24: '', s21: '', s18: '', s15: '', s15o: '', s12: '', s12o: '', s9: '', s9o: '', s6: '3', s6o: '', s3: '14', s3o: '', total: 17 },
                { time: 40, ascent: 1.9, s24: '', s21: '', s18: '', s15: '', s15o: '', s12: '', s12o: '', s9: '', s9o: '', s6: '10', s6o: '', s3: '22', s3o: '', total: 32 },
                { time: 50, ascent: 1.9, s24: '', s21: '', s18: '', s15: '', s15o: '', s12: '', s12o: '', s9: '2', s9o: '', s6: '18', s6o: '', s3: '29', s3o: '', total: 49 },
                { time: 60, ascent: 1.9, s24: '', s21: '', s18: '', s15: '4', s15o: '', s12: '2', s12o: '', s9: '6', s9o: '', s6: '23', s6o: '', s3: '36', s3o: '', total: 71 },
            ],
            39: [
                { time: 30, ascent: 2.1, s24: '', s21: '', s18: '', s15: '', s15o: '', s12: '', s12o: '', s9: '', s9o: '', s6: '7', s6o: '', s3: '20', s3o: '', total: 27 },
                { time: 40, ascent: 2.1, s24: '', s21: '', s18: '', s15: '2', s15o: '', s12: '', s12o: '', s9: '4', s9o: '', s6: '15', s6o: '', s3: '28', s3o: '', total: 49 },
                { time: 50, ascent: 2.1, s24: '', s21: '', s18: '2', s15: '4', s15o: '', s12: '3', s12o: '', s9: '8', s9o: '', s6: '22', s6o: '', s3: '36', s3o: '', total: 75 },
                { time: 60, ascent: 2.1, s24: '', s21: '2', s18: '4', s15: '7', s15o: '', s12: '6', s12o: '', s9: '12', s9o: '', s6: '28', s6o: '', s3: '44', s3o: '', total: 103 },
            ],
            42: [
                { time: 20, ascent: 2.7, s24: '', s21: '', s18: '', s15: '', s15o: '', s12: '', s12o: '', s9: '', s9o: '', s6: '5', s6o: '', s3: '13', s3o: '', total: 18 },
                { time: 30, ascent: 2.4, s24: '', s21: '', s18: '', s15: '', s15o: '', s12: '', s12o: '', s9: '2', s9o: '', s6: '12', s6o: '', s3: '19', s3o: '', total: 33 },
                { time: 40, ascent: 2.1, s24: '', s21: '', s18: '', s15: '1', s15o: '', s12: '2', s12o: '', s9: '6', s9o: '', s6: '18', s6o: '', s3: '29', s3o: '', total: 56 },
                { time: 50, ascent: 2.1, s24: '', s21: '', s18: '1', s15: '3', s15o: '', s12: '4', s12o: '', s9: '10', s9o: '', s6: '25', s6o: '', s3: '37', s3o: '', total: 80 },
                { time: 60, ascent: 1.8, s24: '', s21: '1', s18: '3', s15: '5', s15o: '', s12: '6', s12o: '', s9: '12', s9o: '', s6: '26', s6o: '', s3: '41', s3o: '', total: 94 },
            ],
            45: [
                { time: 15, ascent: 3.3, s24: '', s21: '', s18: '', s15: '', s15o: '', s12: '', s12o: '', s9: '', s9o: '', s6: '4', s6o: '', s3: '9', s3o: '', total: 13 },
                { time: 25, ascent: 3.0, s24: '', s21: '', s18: '', s15: '', s15o: '', s12: '', s12o: '', s9: '1', s9o: '', s6: '9', s6o: '', s3: '15', s3o: '', total: 25 },
                { time: 35, ascent: 2.7, s24: '', s21: '', s18: '', s15: '1', s15o: '', s12: '1', s12o: '', s9: '4', s9o: '', s6: '12', s6o: '', s3: '20', s3o: '', total: 38 },
                { time: 45, ascent: 2.4, s24: '', s21: '', s18: '1', s15: '2', s15o: '', s12: '3', s12o: '', s9: '8', s9o: '', s6: '18', s6o: '', s3: '28', s3o: '', total: 60 },
                { time: 55, ascent: 2.1, s24: '', s21: '1', s18: '2', s15: '4', s15o: '', s12: '6', s12o: '', s9: '11', s9o: '', s6: '23', s6o: '', s3: '36', s3o: '', total: 83 },
            ]
        };
        
        const tup = {
            calculate() {
                const maxDepth = parseFloat(document.getElementById('maxDepth').value) || 0;
                const o2 = parseFloat(document.getElementById('o2').value) || 21;
                const diveTime = parseFloat(document.getElementById('diveTime').value) || 0;
                
                if (maxDepth < 0 || diveTime < 0) {
                    alert('Depth and time must be positive values');
                    return;
                }
                
                if (o2 !== 21 && (o2 < 30 || o2 > 40)) {
                    alert('Only 21% and 30-40% O2 allowed');
                    return;
                }
                
                const fractionN2 = (100 - o2) / 100;
                const ead = (maxDepth + 10) * (fractionN2 / 0.79) - 10;
                const eadRounded = Math.ceil(ead * 10) / 10;
                
                const po2 = (o2 / 100) * (maxDepth / 10 + 1);
                
                const nearestDepth = Object.keys(IMCA_TUP_LIMITS).map(Number).reduce((prev, curr) =>
                    Math.abs(curr - maxDepth) < Math.abs(prev - maxDepth) ? curr : prev
                );
                const maxBT = IMCA_TUP_LIMITS[nearestDepth];
                
                const tableDepths = Object.keys(DECOMPRESSION_DATA).map(Number).sort((a, b) => a - b);
                const tableDepth = tableDepths.find(d => ead <= d) || tableDepths[tableDepths.length - 1];
                
                document.getElementById('ead').textContent = eadRounded.toFixed(1) + ' m';
                document.getElementById('po2').textContent = po2.toFixed(2) + ' bar';
                document.getElementById('maxBottomTime').textContent = maxBT + ' min';
                document.getElementById('tableUse').textContent = tableDepth + ' m';
                
                this.renderTable(tableDepth, diveTime);
            },
            
            renderTable(depth, selectedTime) {
                const tbody = document.getElementById('tableBody');
                tbody.innerHTML = '';
                
                const rows = DECOMPRESSION_DATA[depth] || [];
                rows.forEach(row => {
                    const isSelected = Math.abs(row.time - selectedTime) < 5;
                    const tr = document.createElement('tr');
                    tr.className = isSelected ? 'highlight' : '';
                    
                    tr.innerHTML = `
                        <td>${depth}</td>
                        <td>${row.time}</td>
                        <td>${row.ascent}</td>
                        <td>${row.s24 || '‚Äî'}</td>
                        <td>${row.s21 || '‚Äî'}</td>
                        <td>${row.s18 || '‚Äî'}</td>
                        <td>${row.s15 || '‚Äî'}</td>
                        <td class="oxy-col">${row.s15o || '‚Äî'}</td>
                        <td>${row.s12 || '‚Äî'}</td>
                        <td class="oxy-col">${row.s12o || '‚Äî'}</td>
                        <td>${row.s9 || '‚Äî'}</td>
                        <td class="oxy-col">${row.s9o || '‚Äî'}</td>
                        <td>${row.s6 || '‚Äî'}</td>
                        <td class="oxy-col">${row.s6o || '‚Äî'}</td>
                        <td>${row.s3 || '‚Äî'}</td>
                        <td class="oxy-col">${row.s3o || '‚Äî'}</td>
                        <td><strong>${row.total}</strong></td>
                    `;
                    tbody.appendChild(tr);
                });
            },
            
            reset() {
                document.getElementById('maxDepth').value = '30';
                document.getElementById('o2').value = '21';
                document.getElementById('diveTime').value = '45';
                document.getElementById('ead').textContent = '‚Äî';
                document.getElementById('po2').textContent = '‚Äî';
                document.getElementById('maxBottomTime').textContent = '‚Äî';
                document.getElementById('tableUse').textContent = '‚Äî';
                document.getElementById('tableBody').innerHTML = '';
            }
        };
    </script>
</body>
</html>
